---
title: Le modèle de fournisseur Entity Framework 6 - EF6
author: divega
ms.date: 2018-06-27
ms.prod: entity-framework
ms.author: divega
ms.manager: avickers
ms.technology: entity-framework-6
ms.topic: article
ms.assetid: 066832F0-D51B-4655-8BE7-C983C557E0E4
caps.latest.revision: 3
ms.openlocfilehash: 49b655bdbe1b256b7de517edec84945d1ee06f79
ms.sourcegitcommit: f05e7b62584cf228f17390bb086a61d505712e1b
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/08/2018
ms.locfileid: "39120864"
---
# <a name="the-entity-framework-6-provider-model"></a><span data-ttu-id="f3378-102">Le modèle de fournisseur Entity Framework 6</span><span class="sxs-lookup"><span data-stu-id="f3378-102">The Entity Framework 6 provider model</span></span>

<span data-ttu-id="f3378-103">Le modèle de fournisseur Entity Framework permet à Entity Framework à utiliser avec différents types de serveur de base de données.</span><span class="sxs-lookup"><span data-stu-id="f3378-103">The Entity Framework provider model allows Entity Framework to be used with different types of database server.</span></span> <span data-ttu-id="f3378-104">Par exemple, un seul fournisseur peut être branché pour permettre d’EF être exploitée dans Microsoft SQL Server, tandis qu’un autre fournisseur peut être raccordé à pour permettre d’EF être exploitée dans Microsoft SQL Server Compact Edition.</span><span class="sxs-lookup"><span data-stu-id="f3378-104">For example, one provider can be plugged in to allow EF to be used against Microsoft SQL Server, while another provider can be plugged into to allow EF to be used against Microsoft SQL Server Compact Edition.</span></span> <span data-ttu-id="f3378-105">Vous trouverez les fournisseurs pour EF6 que nous sommes conscients de sur le [fournisseurs d’Entity Framework](~/ef6/fundamentals/providers/index.md) page.</span><span class="sxs-lookup"><span data-stu-id="f3378-105">The providers for EF6 that we are aware of can be found on the [Entity Framework providers](~/ef6/fundamentals/providers/index.md) page.</span></span>

<span data-ttu-id="f3378-106">Certaines modifications étaient nécessaires à la façon dont EF interagit avec les fournisseurs d’Entity Framework pour être commercialisées sous une licence open source.</span><span class="sxs-lookup"><span data-stu-id="f3378-106">Certain changes were required to the way EF interacts with providers to allow EF to be released under an open source license.</span></span> <span data-ttu-id="f3378-107">Ces modifications exigent une reconstruction de fournisseurs EF sur les assemblys EF6 ainsi que de nouveaux mécanismes pour l’inscription du fournisseur.</span><span class="sxs-lookup"><span data-stu-id="f3378-107">These changes require rebuilding of EF providers against the EF6 assemblies together with new mechanisms for registration of the provider.</span></span>

## <a name="rebuilding"></a><span data-ttu-id="f3378-108">La reconstruction</span><span class="sxs-lookup"><span data-stu-id="f3378-108">Rebuilding</span></span>

<span data-ttu-id="f3378-109">Avec EF6 code principal qui faisait précédemment partie du .NET Framework est désormais fourni en tant que les assemblys hors-bande (OOB).</span><span class="sxs-lookup"><span data-stu-id="f3378-109">With EF6 the core code that was previously part of the .NET Framework is now being shipped as out-of-band (OOB) assemblies.</span></span> <span data-ttu-id="f3378-110">Vous trouverez plus d’informations sur la façon de créer des applications dans EF6 sur le [mise à jour des applications pour EF6](~/ef6/what-is-new/upgrading-to-ef6.md) page.</span><span class="sxs-lookup"><span data-stu-id="f3378-110">Details on how to build applications against EF6 can be found on the [Updating applications for EF6](~/ef6/what-is-new/upgrading-to-ef6.md) page.</span></span> <span data-ttu-id="f3378-111">Fournisseurs devez également être reconstruits à l’aide de ces instructions.</span><span class="sxs-lookup"><span data-stu-id="f3378-111">Providers will also need to be rebuilt using these instructions.</span></span>

## <a name="provider-types-overview"></a><span data-ttu-id="f3378-112">Vue d’ensemble des types de fournisseur</span><span class="sxs-lookup"><span data-stu-id="f3378-112">Provider types overview</span></span>

<span data-ttu-id="f3378-113">Un fournisseur EF est vraiment une collection de services spécifiques au fournisseur définis par les types CLR que ces services étendre à partir de (pour une classe de base) ou implémentent (pour une interface).</span><span class="sxs-lookup"><span data-stu-id="f3378-113">An EF provider is really a collection of provider-specific services defined by CLR types that these services extend from (for a base class) or implement (for an interface).</span></span> <span data-ttu-id="f3378-114">Deux de ces services sont fondamentaux et nécessaire pour Entity Framework de fonctionner tout.</span><span class="sxs-lookup"><span data-stu-id="f3378-114">Two of these services are fundamental and necessary for EF to function at all.</span></span> <span data-ttu-id="f3378-115">D’autres sont facultatifs et uniquement besoin d’être implémentée si une fonctionnalité spécifique est requise et/ou les implémentations par défaut de ces services ne fonctionne pas pour le serveur de base de données spécifique qui est ciblé.</span><span class="sxs-lookup"><span data-stu-id="f3378-115">Others are optional and only need to be implemented if specific functionality is required and/or the default implementations of these services does not work for the specific database server being targeted.</span></span>

### <a name="fundamental-provider-types"></a><span data-ttu-id="f3378-116">Types de fournisseurs fondamentaux</span><span class="sxs-lookup"><span data-stu-id="f3378-116">Fundamental provider types</span></span>

#### <a name="dbproviderfactory"></a><span data-ttu-id="f3378-117">DbProviderFactory</span><span class="sxs-lookup"><span data-stu-id="f3378-117">DbProviderFactory</span></span>

<span data-ttu-id="f3378-118">EF dépend d’un type dérivé [System.Data.Common.DbProviderFactory](http://msdn.microsoft.com/en-us/library/system.data.common.dbproviderfactory.aspx) pour l’exécution de tous les accès de bas niveau de la base de données.</span><span class="sxs-lookup"><span data-stu-id="f3378-118">EF depends on having a type derived from [System.Data.Common.DbProviderFactory](http://msdn.microsoft.com/en-us/library/system.data.common.dbproviderfactory.aspx) for performing all low-level database access.</span></span> <span data-ttu-id="f3378-119">DbProviderFactory ne faisant pas partie d’EF mais est plutôt une classe dans le .NET Framework qui fait Office de point d’entrée pour les fournisseurs ADO.NET qui peut être utilisée par Entity Framework, autres O/RMs, ou directement par une application pour obtenir des instances de connexions, les commandes, les paramètres et autres abstractions ADO.NET dans un fournisseur de façon indépendante.</span><span class="sxs-lookup"><span data-stu-id="f3378-119">DbProviderFactory is not actually part of EF but is instead a class in the .NET Framework that serves an entry point for ADO.NET providers that can be used by EF, other O/RMs or directly by an application to obtain instances of connections, commands, parameters and other ADO.NET abstractions in a provider agnostic way.</span></span> <span data-ttu-id="f3378-120">Plus d’informations sur DbProviderFactory un se trouve dans le [documentation MSDN pour ADO.NET](http://msdn.microsoft.com/en-us/library/a6cd7c08.aspx).</span><span class="sxs-lookup"><span data-stu-id="f3378-120">More information about DbProviderFactory an be found in the [MSDN documentation for ADO.NET](http://msdn.microsoft.com/en-us/library/a6cd7c08.aspx).</span></span>

#### <a name="dbproviderservices"></a><span data-ttu-id="f3378-121">DbProviderServices</span><span class="sxs-lookup"><span data-stu-id="f3378-121">DbProviderServices</span></span>

<span data-ttu-id="f3378-122">EF dépend d’avoir un type dérivé DbProviderServices de fournir des fonctionnalités supplémentaires requises par Entity Framework en haut de la fonctionnalité déjà fournie par le fournisseur ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="f3378-122">EF depends on having a type derived from DbProviderServices for providing additional functionality needed by EF on top of the functionality already provided by the ADO.NET provider.</span></span> <span data-ttu-id="f3378-123">Dans les versions antérieures d’EF la classe DbProviderServices faisait partie du .NET Framework et a été trouvée dans l’espace de noms System.Data.Common.</span><span class="sxs-lookup"><span data-stu-id="f3378-123">In older versions of EF the DbProviderServices class was part of the .NET Framework and was found in the System.Data.Common namespace.</span></span> <span data-ttu-id="f3378-124">EF6 compter de cette classe est désormais partie de l’EntityFramework.dll et est dans l’espace de noms System.Data.Entity.Core.Common.</span><span class="sxs-lookup"><span data-stu-id="f3378-124">Starting with EF6 this class is now part of EntityFramework.dll and is in the System.Data.Entity.Core.Common namespace.</span></span>

<span data-ttu-id="f3378-125">Vous trouverez plus d’informations sur la fonctionnalité fondamentale d’une implémentation DbProviderServices sur [MSDN](http://msdn.microsoft.com/en-us/library/ee789835.aspx).</span><span class="sxs-lookup"><span data-stu-id="f3378-125">More details about the fundamental functionality of a DbProviderServices implementation can be found on [MSDN](http://msdn.microsoft.com/en-us/library/ee789835.aspx).</span></span> <span data-ttu-id="f3378-126">Toutefois, notez qu’au moment de l’écriture de ces informations n'est pas mis à jour pour EF6 bien que la plupart des concepts est toujours valide.</span><span class="sxs-lookup"><span data-stu-id="f3378-126">However, note that as of the time of writing this information is not updated for EF6 although most of the concepts are still valid.</span></span> <span data-ttu-id="f3378-127">Les implémentations de SQL Server et SQL Server Compact de DbProviderServices sont également archivées dans à la [codebase open source](https://gihtub.com/aspnet/EntityFramework6/) et peuvent servir de référence utile pour d’autres implémentations.</span><span class="sxs-lookup"><span data-stu-id="f3378-127">The SQL Server and SQL Server Compact implementations of DbProviderServices are also checked into to the [open-source codebase](https://gihtub.com/aspnet/EntityFramework6/) and can serve as useful references for other implementations.</span></span>

<span data-ttu-id="f3378-128">Dans les versions antérieures d’EF implémentation DbProviderServices à utiliser a été obtenue directement à partir d’un fournisseur ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="f3378-128">In older versions of EF the DbProviderServices implementation to use was obtained directly from an ADO.NET provider.</span></span> <span data-ttu-id="f3378-129">Cela a été effectuée en effectuant un cast de DbProviderFactory de IServiceProvider en appelant la méthode GetService.</span><span class="sxs-lookup"><span data-stu-id="f3378-129">This was done by casting DbProviderFactory to IServiceProvider and calling the GetService method.</span></span> <span data-ttu-id="f3378-130">Cela étroitement le fournisseur EF DbProviderFactory.</span><span class="sxs-lookup"><span data-stu-id="f3378-130">This tightly coupled the EF provider to the DbProviderFactory.</span></span> <span data-ttu-id="f3378-131">Ce couplage bloqué EF enlève le .NET Framework et pour EF6 ce couplage étroit a donc été supprimé et une implémentation de DbProviderServices est maintenant inscrit directement dans le fichier de configuration de l’application ou dans la base de code configuration comme décrit plus en détail la _DbProviderServices inscription_ section ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="f3378-131">This coupling blocked EF from being moved out of the .NET Framework and therefore for EF6 this tight coupling has been removed and an implementation of DbProviderServices is now registered directly in the application’s configuration file or in code-based configuration as described in more detail the _Registering DbProviderServices_ section below.</span></span>

### <a name="additional-services"></a><span data-ttu-id="f3378-132">Services supplémentaires</span><span class="sxs-lookup"><span data-stu-id="f3378-132">Additional services</span></span>

<span data-ttu-id="f3378-133">En plus des services fondamentaux décrits ci-dessus, il existe également beaucoup d’autres services utilisés par Entity Framework qui est systématiquement ou parfois spécifiques au fournisseur.</span><span class="sxs-lookup"><span data-stu-id="f3378-133">In addition to the fundamental services described above there are also many other services used by EF which are either always or sometimes provider-specific.</span></span> <span data-ttu-id="f3378-134">Les implémentations spécifiques au fournisseur par défaut de ces services peuvent être fournies par une implémentation DbProviderServices.</span><span class="sxs-lookup"><span data-stu-id="f3378-134">Default provider-specific implementations of these services can be supplied by a DbProviderServices implementation.</span></span> <span data-ttu-id="f3378-135">Les applications peuvent également remplacer les implémentations de ces services ou fournir des implémentations lorsqu’un type DbProviderServices ne fournit pas de valeur par défaut.</span><span class="sxs-lookup"><span data-stu-id="f3378-135">Applications can also override the implementations of these services, or provide implementations when a DbProviderServices type does not provide a default.</span></span> <span data-ttu-id="f3378-136">Cette opération est décrite plus en détail dans le _des services supplémentaires de résolution_ section ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="f3378-136">This is described in more detail in the _Resolving additional services_ section below.</span></span>

<span data-ttu-id="f3378-137">Les types de service supplémentaires un fournisseur peut-être être utiles à un fournisseur sont répertoriées ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="f3378-137">The additional service types that a provider may be of interest to a provider are listed below.</span></span> <span data-ttu-id="f3378-138">Vous trouverez plus d’informations sur chacun de ces types de service dans la documentation de l’API.</span><span class="sxs-lookup"><span data-stu-id="f3378-138">More details about each of these service types can be found in the API documentation.</span></span>

#### <a name="idbexecutionstrategy"></a><span data-ttu-id="f3378-139">IDbExecutionStrategy</span><span class="sxs-lookup"><span data-stu-id="f3378-139">IDbExecutionStrategy</span></span>

<span data-ttu-id="f3378-140">Il s’agit d’un service facultatif qui permet à un fournisseur implémenter les nouvelles tentatives ou un autre comportement lorsque les requêtes et les commandes sont exécutées sur la base de données.</span><span class="sxs-lookup"><span data-stu-id="f3378-140">This is an optional service that allows a provider to implement retries or other behavior when queries and commands are executed against the database.</span></span> <span data-ttu-id="f3378-141">Si aucune implémentation n’est fournie, puis EF sera simplement exécuter les commandes et propager toutes les exceptions levées.</span><span class="sxs-lookup"><span data-stu-id="f3378-141">If no implementation is provided, then EF will simply execute the commands and propagate any exceptions thrown.</span></span> <span data-ttu-id="f3378-142">Pour SQL Server ce service est utilisé pour fournir une stratégie de nouvelle tentative, ce qui est particulièrement utile lors de l’exécution par rapport à des serveurs de base de données basée sur le cloud, tels que SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="f3378-142">For SQL Server this service is used to provide a retry policy which is especially useful when running against cloud-based database servers such as SQL Azure.</span></span>

#### <a name="idbconnectionfactory"></a><span data-ttu-id="f3378-143">IDbConnectionFactory</span><span class="sxs-lookup"><span data-stu-id="f3378-143">IDbConnectionFactory</span></span>

<span data-ttu-id="f3378-144">Il s’agit d’un service facultatif qui permet à un fournisseur créer des objets de DbConnection par convention donné uniquement un nom de la base de données.</span><span class="sxs-lookup"><span data-stu-id="f3378-144">This is an optional service that allows a provider to create DbConnection objects by convention when given only a database name.</span></span> <span data-ttu-id="f3378-145">Notez que bien que ce service peut être résolu par une implémentation DbProviderServices il était présente depuis EF 4.1 et peut également être explicitement définie dans le fichier de configuration ou dans le code.</span><span class="sxs-lookup"><span data-stu-id="f3378-145">Note that while this service can be resolved by a DbProviderServices implementation it has been present since EF 4.1 and can also be explicitly set in either the config file or in code.</span></span> <span data-ttu-id="f3378-146">Le fournisseur obtient uniquement la possibilité de résoudre ce service s’il est inscrit en tant que le fournisseur par défaut (consultez _le fournisseur par défaut_ ci-dessous) et si une fabrique de connexion par défaut n’est pas définie ailleurs.</span><span class="sxs-lookup"><span data-stu-id="f3378-146">The provider will only get a chance to resolve this service if it registered as the default provider (see _The default provider_ below) and if a default connection factory has not been set elsewhere.</span></span>

#### <a name="dbspatialservices"></a><span data-ttu-id="f3378-147">DbSpatialServices</span><span class="sxs-lookup"><span data-stu-id="f3378-147">DbSpatialServices</span></span>

<span data-ttu-id="f3378-148">Il s’agit d’un services facultatif qui permet à un fournisseur à ajouter la prise en charge pour les types geography et geometry spatiaux.</span><span class="sxs-lookup"><span data-stu-id="f3378-148">This is an optional services that allows a provider to add support for geography and geometry spatial types.</span></span> <span data-ttu-id="f3378-149">Une implémentation de ce service doit être fournie pour une application à utiliser EF avec des types spatiaux.</span><span class="sxs-lookup"><span data-stu-id="f3378-149">An implementation of this service must be supplied in order for an application to use EF with spatial types.</span></span> <span data-ttu-id="f3378-150">DbSptialServices est invité à entrer de deux manières.</span><span class="sxs-lookup"><span data-stu-id="f3378-150">DbSptialServices is asked for in two ways.</span></span> <span data-ttu-id="f3378-151">Tout d’abord, spécifique au fournisseur de services spatiaux sont demandés à l’aide d’un objet DbProviderInfo (qui contient l’invariant jeton de nom et le manifest) en tant que clé.</span><span class="sxs-lookup"><span data-stu-id="f3378-151">First, provider-specific spatial services are requested using a DbProviderInfo object (which contains invariant name and manifest token) as key.</span></span> <span data-ttu-id="f3378-152">En second lieu, DbSpatialServices peuvent être demandées sans clé.</span><span class="sxs-lookup"><span data-stu-id="f3378-152">Second, DbSpatialServices can be asked for with no key.</span></span> <span data-ttu-id="f3378-153">Cela permet de résoudre le « spatial mondial » qui est utilisé lors de la création des types de DbGeography ou DbGeometry autonomes.</span><span class="sxs-lookup"><span data-stu-id="f3378-153">This is used to resolve the “global spatial provider” that is used when creating stand-alone DbGeography or DbGeometry types.</span></span>

#### <a name="migrationsqlgenerator"></a><span data-ttu-id="f3378-154">MigrationSqlGenerator</span><span class="sxs-lookup"><span data-stu-id="f3378-154">MigrationSqlGenerator</span></span>

<span data-ttu-id="f3378-155">Il s’agit d’un service facultatif qui permet des Migrations Entity Framework à utiliser pour la génération de la session SQL utilisée dans la création et modification des schémas de base de données par Code First.</span><span class="sxs-lookup"><span data-stu-id="f3378-155">This is an optional service that allows EF Migrations to be used for the generation of SQL used in creating and modifying database schemas by Code First.</span></span> <span data-ttu-id="f3378-156">Une implémentation est requise pour prendre en charge les Migrations.</span><span class="sxs-lookup"><span data-stu-id="f3378-156">An implementation is required in order to support Migrations.</span></span> <span data-ttu-id="f3378-157">Si une implémentation est fournie, il sera également utiliser lors de la création de bases de données à l’aide d’initialiseurs de base de données ou la méthode Database.Create.</span><span class="sxs-lookup"><span data-stu-id="f3378-157">If an implementation is provided then it will also be used when databases are created using database initializers or the Database.Create method.</span></span>

#### <a name="funcdbconnection-string-historycontextfactory"></a><span data-ttu-id="f3378-158">Func < DbConnection, chaîne, HistoryContextFactory ></span><span class="sxs-lookup"><span data-stu-id="f3378-158">Func<DbConnection, string, HistoryContextFactory></span></span>

<span data-ttu-id="f3378-159">Il s’agit d’un service facultatif qui permet à un fournisseur configurer le mappage de la HistoryContext à la `__MigrationHistory` table utilisée par des Migrations Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="f3378-159">This is an optional service that allows a provider to configure the mapping of the HistoryContext to the `__MigrationHistory` table used by EF Migrations.</span></span> <span data-ttu-id="f3378-160">Le HistoryContext est un Code premier DbContext et peut être configuré à l’aide de l’API fluent normale pour modifier des éléments tels que le nom de la table et les spécifications de mappage de colonne.</span><span class="sxs-lookup"><span data-stu-id="f3378-160">The HistoryContext is a Code First DbContext and can be configured using the normal fluent API to change things like the name of the table and the column mapping specifications.</span></span> <span data-ttu-id="f3378-161">L’implémentation par défaut de ce service retourné par EF pour tous les fournisseurs peut-être fonctionner pour un serveur de base de données donné si tous les mappages table et de colonne par défaut sont pris en charge par le fournisseur.</span><span class="sxs-lookup"><span data-stu-id="f3378-161">The default implementation of this service returned by EF for all providers may work for a given database server if all the default table and column mappings are supported by that provider.</span></span> <span data-ttu-id="f3378-162">Dans ce cas le fournisseur est inutile de fournir une implémentation de ce service.</span><span class="sxs-lookup"><span data-stu-id="f3378-162">In such a case the provider does not need to supply an implementation of this service.</span></span>

#### <a name="idbproviderfactoryresolver"></a><span data-ttu-id="f3378-163">IDbProviderFactoryResolver</span><span class="sxs-lookup"><span data-stu-id="f3378-163">IDbProviderFactoryResolver</span></span>

<span data-ttu-id="f3378-164">Il s’agit d’un service facultatif pour l’obtention du DbProviderFactory correct à partir d’un objet DbConnection donné.</span><span class="sxs-lookup"><span data-stu-id="f3378-164">This is an optional service for obtaining the correct DbProviderFactory from a given DbConnection object.</span></span> <span data-ttu-id="f3378-165">L’implémentation par défaut de ce service retourné par EF pour tous les fournisseurs est destinée à fonctionner pour tous les fournisseurs.</span><span class="sxs-lookup"><span data-stu-id="f3378-165">The default implementation of this service returned by EF for all providers is intended to work for all providers.</span></span> <span data-ttu-id="f3378-166">Toutefois, lors de l’exécution sur .NET 4, DbProviderFactory n’est pas accessible publiquement à partir d’un seul si son DbConnections.</span><span class="sxs-lookup"><span data-stu-id="f3378-166">However, when running on .NET 4, the DbProviderFactory is not publicly accessible from one if its DbConnections.</span></span> <span data-ttu-id="f3378-167">Par conséquent, EF utilise quelques méthodes heuristiques pour rechercher les fournisseurs inscrits pour rechercher une correspondance.</span><span class="sxs-lookup"><span data-stu-id="f3378-167">Therefore, EF uses some heuristics to search the registered providers to find a match.</span></span> <span data-ttu-id="f3378-168">Il est possible que pour certains fournisseurs ces heuristiques échouera et dans ce cas, le fournisseur doit fournir une nouvelle implémentation.</span><span class="sxs-lookup"><span data-stu-id="f3378-168">It is possible that for some providers these heuristics will fail and in such situations the provider should supply a new implementation.</span></span>

## <a name="registering-dbproviderservices"></a><span data-ttu-id="f3378-169">L’inscription DbProviderServices</span><span class="sxs-lookup"><span data-stu-id="f3378-169">Registering DbProviderServices</span></span>

<span data-ttu-id="f3378-170">Implémentation DbProviderServices à utiliser peut être inscrits dans l’application à l’aide de la configuration basée sur le code ou de fichier de configuration (app.config ou web.config).</span><span class="sxs-lookup"><span data-stu-id="f3378-170">The DbProviderServices implementation to use can be registered either in the application’s configuration file (app.config or web.config) or using code-based configuration.</span></span> <span data-ttu-id="f3378-171">Dans les deux cas, l’inscription utilise le nom du fournisseur « indifférent » en tant que clé.</span><span class="sxs-lookup"><span data-stu-id="f3378-171">In either case the registration uses the provider’s “invariant name” as a key.</span></span> <span data-ttu-id="f3378-172">Cela permet à plusieurs fournisseurs être enregistrés et utilisés dans une application unique.</span><span class="sxs-lookup"><span data-stu-id="f3378-172">This allows multiple providers to be registered and used in a single application.</span></span> <span data-ttu-id="f3378-173">Le nom invariant est utilisé pour les inscriptions d’EF est la même que le nom invariant utilisé pour les chaînes de l’inscription et connexion de fournisseur ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="f3378-173">The invariant name used for EF registrations is the same as the invariant name used for ADO.NET provider registration and connection strings.</span></span> <span data-ttu-id="f3378-174">Par exemple, pour SQL Server, le nom invariant « System.Data.SqlClient » est utilisé.</span><span class="sxs-lookup"><span data-stu-id="f3378-174">For example, for SQL Server the invariant name “System.Data.SqlClient” is used.</span></span>

### <a name="config-file-registration"></a><span data-ttu-id="f3378-175">Inscription dans le fichier config</span><span class="sxs-lookup"><span data-stu-id="f3378-175">Config file registration</span></span>

<span data-ttu-id="f3378-176">Le type DbProviderServices à utiliser est enregistré comme un élément de fournisseur dans la liste des fournisseurs de la section entityFramework de fichier de configuration de l’application.</span><span class="sxs-lookup"><span data-stu-id="f3378-176">The DbProviderServices type to use is registered as a provider element in the providers list of the entityFramework section of the application’s config file.</span></span> <span data-ttu-id="f3378-177">Exemple :</span><span class="sxs-lookup"><span data-stu-id="f3378-177">For example:</span></span>

``` xml
<entityFramework>
  <providers>
    <provider invariantName="My.Invariant.Name" type="MyProvider.MyProviderServices, MyAssembly" />
  </providers>
</entityFramework>
```

<span data-ttu-id="f3378-178">Le _type_ chaîne doit être le nom de type qualifié d’assembly de l’implémentation DbProviderServices à utiliser.</span><span class="sxs-lookup"><span data-stu-id="f3378-178">The _type_ string must be the assembly-qualified type name of the DbProviderServices implementation to use.</span></span>

### <a name="code-based-registration"></a><span data-ttu-id="f3378-179">Inscription basée sur le code</span><span class="sxs-lookup"><span data-stu-id="f3378-179">Code-based registration</span></span>

<span data-ttu-id="f3378-180">En commençant par les fournisseurs de EF6 peut aussi être inscrits à l’aide de code.</span><span class="sxs-lookup"><span data-stu-id="f3378-180">Starting with EF6 providers can also be registered using code.</span></span> <span data-ttu-id="f3378-181">Ainsi, un fournisseur EF utilisable sans aucune modification au fichier de configuration de l’application.</span><span class="sxs-lookup"><span data-stu-id="f3378-181">This allows an EF provider to be used without any change to the application’s configuration file.</span></span> <span data-ttu-id="f3378-182">Pour utiliser la configuration basée sur le code une application doit créer une classe DbConfiguration, comme décrit dans la [documentation de configuration basée sur le code](http://msdn.com/data/jj680699).</span><span class="sxs-lookup"><span data-stu-id="f3378-182">To use code-based configuration an application should create a DbConfiguration class as described in the [code-based configuration documentation](http://msdn.com/data/jj680699).</span></span> <span data-ttu-id="f3378-183">Le constructeur de la classe DbConfiguration doit appeler SetProviderServices pour inscrire le fournisseur Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="f3378-183">The constructor of the DbConfiguration class should then call SetProviderServices to register the EF provider.</span></span> <span data-ttu-id="f3378-184">Exemple :</span><span class="sxs-lookup"><span data-stu-id="f3378-184">For example:</span></span>

``` csharp
public class MyConfiguration : DbConfiguration
{
    public MyConfiguration()
    {
        SetProviderServices("My.New.Provider", new MyProviderServices());
    }
}
```

## <a name="resolving-additional-services"></a><span data-ttu-id="f3378-185">Résoudre des services supplémentaires</span><span class="sxs-lookup"><span data-stu-id="f3378-185">Resolving additional services</span></span>

<span data-ttu-id="f3378-186">Comme indiqué plus haut dans la _présentation des types de fournisseur_ section, un DbProviderServices classe peut également être utilisée pour résoudre des services supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="f3378-186">As mentioned above in the _Provider types overview_ section, a DbProviderServices class can also be used to resolve additional services.</span></span> <span data-ttu-id="f3378-187">Cela est possible car DbProviderServices implémente IDbDependencyResolver et chaque type DbProviderServices enregistré est ajouté comme un « programme de résolution par défaut ».</span><span class="sxs-lookup"><span data-stu-id="f3378-187">This is possible because DbProviderServices implements IDbDependencyResolver and each registered DbProviderServices type is added as a “default resolver”.</span></span> <span data-ttu-id="f3378-188">Le mécanisme de IDbDpendencyResolver est décrite plus en détail dans [résolution des dépendances](~/ef6/fundamentals/configuring/dependency-resolution.md).</span><span class="sxs-lookup"><span data-stu-id="f3378-188">The IDbDpendencyResolver mechanism is described in more detail in [Dependency Resolution](~/ef6/fundamentals/configuring/dependency-resolution.md).</span></span> <span data-ttu-id="f3378-189">Toutefois, il n’est pas nécessaire de comprendre tous les concepts dans cette spécification pour résoudre des services supplémentaires dans un fournisseur.</span><span class="sxs-lookup"><span data-stu-id="f3378-189">However, it is not necessary to understand all the concepts in this specification to resolve additional services in a provider.</span></span>

<span data-ttu-id="f3378-190">La méthode la plus courante pour un fournisseur résoudre des services supplémentaires consiste à appeler DbProviderServices.AddDependencyResolver pour chaque service dans le constructeur de la classe DbProviderServices.</span><span class="sxs-lookup"><span data-stu-id="f3378-190">The most common way for a provider to resolve additional services is to call DbProviderServices.AddDependencyResolver for each service in the constructor of the DbProviderServices class.</span></span> <span data-ttu-id="f3378-191">Par exemple, SqlProviderServices (le fournisseur Entity Framework pour SQL Server) a code similaire à celui-ci pour l’initialisation :</span><span class="sxs-lookup"><span data-stu-id="f3378-191">For example, SqlProviderServices (the EF provider for SQL Server) has code similar to this for initialization:</span></span>

``` csharp
private SqlProviderServices()
{
    AddDependencyResolver(new SingletonDependencyResolver<IDbConnectionFactory>(
        new SqlConnectionFactory()));

    AddDependencyResolver(new ExecutionStrategyResolver<DefaultSqlExecutionStrategy>(
        "System.data.SqlClient", null, () => new DefaultSqlExecutionStrategy()));

    AddDependencyResolver(new SingletonDependencyResolver<Func<MigrationSqlGenerator>>(
        () => new SqlServerMigrationSqlGenerator(), "System.data.SqlClient"));

    AddDependencyResolver(new SingletonDependencyResolver<DbSpatialServices>(
        SqlSpatialServices.Instance,
        k =>
        {
            var asSpatialKey = k as DbProviderInfo;
            return asSpatialKey == null
                || asSpatialKey.ProviderInvariantName == ProviderInvariantName;
        }));
}
```

<span data-ttu-id="f3378-192">Ce constructeur utilise les classes d’assistance suivantes :</span><span class="sxs-lookup"><span data-stu-id="f3378-192">This constructor uses the following helper classes:</span></span>

*   <span data-ttu-id="f3378-193">SingletonDependencyResolver : fournit un moyen simple pour résoudre des services de Singleton, autrement dit, les services pour lesquels la même instance est retournée chaque fois que GetService est appelée.</span><span class="sxs-lookup"><span data-stu-id="f3378-193">SingletonDependencyResolver: provides a simple way to resolve Singleton services—that is, services for which the same instance is returned each time that GetService is called.</span></span> <span data-ttu-id="f3378-194">Services transitoires sont souvent enregistrés comme une fabrique de singleton qui servira à créer des instances temporaires à la demande.</span><span class="sxs-lookup"><span data-stu-id="f3378-194">Transient services are often registered as a singleton factory that will be used to create transient instances on demand.</span></span>
*   <span data-ttu-id="f3378-195">ExecutionStrategyResolver : un programme de résolution spécifique pour retourner des implémentations de IExecutionStrategy.</span><span class="sxs-lookup"><span data-stu-id="f3378-195">ExecutionStrategyResolver: a resolver specific to returning IExecutionStrategy implementations.</span></span>

<span data-ttu-id="f3378-196">Au lieu d’utiliser DbProviderServices.AddDependencyResolver, il est également possible de remplacer DbProviderServices.GetService et résoudre des services supplémentaires directement.</span><span class="sxs-lookup"><span data-stu-id="f3378-196">Instead of using DbProviderServices.AddDependencyResolver it is also possible to override DbProviderServices.GetService and resolve additional services directly.</span></span> <span data-ttu-id="f3378-197">Cette méthode est appelée quand EF a besoin d’un service défini par un certain type et, dans certains cas, pour une clé donnée.</span><span class="sxs-lookup"><span data-stu-id="f3378-197">This method will be called when EF needs a service defined by a certain type and, in some cases, for a given key.</span></span> <span data-ttu-id="f3378-198">La méthode doit retourner le service s’il peut, ou retournez null pour les annulations de retourner le service et permettre à la place une autre classe résoudre le problème.</span><span class="sxs-lookup"><span data-stu-id="f3378-198">The method should return the service if it can, or return null to opt-out of returning the service and instead allow another class to resolve it.</span></span> <span data-ttu-id="f3378-199">Par exemple, pour résoudre la fabrique de connexion par défaut le code dans GetService peut ressembler à ceci :</span><span class="sxs-lookup"><span data-stu-id="f3378-199">For example, to resolve the default connection factory the code in GetService might look something like this:</span></span>

``` csharp
public override object GetService(Type type, object key)
{
    if (type == typeof(IDbConnectionFactory))
    {
        return new SqlConnectionFactory();
    }
    return null;
}
```

### <a name="registration-order"></a><span data-ttu-id="f3378-200">Ordre d’inscription</span><span class="sxs-lookup"><span data-stu-id="f3378-200">Registration order</span></span>

<span data-ttu-id="f3378-201">Lorsque plusieurs implémentations DbProviderServices sont enregistrées dans le fichier de configuration d’une application, ils seront ajoutés en tant que programmes de résolution secondaire dans l’ordre d’apparition.</span><span class="sxs-lookup"><span data-stu-id="f3378-201">When multiple DbProviderServices implementations are registered in an application’s config file they will be added as secondary resolvers in the order that they are listed.</span></span> <span data-ttu-id="f3378-202">Dans la mesure où les programmes de résolution soient toujours ajoutées à la partie supérieure de la chaîne de programme de résolution secondaire que cela signifie que le fournisseur à la fin de la liste obtiendront une chance à résoudre les dépendances avant les autres.</span><span class="sxs-lookup"><span data-stu-id="f3378-202">Since resolvers are always added to the top of the secondary resolver chain this means that the provider at the end of the list will get a chance to resolve dependencies before the others.</span></span> <span data-ttu-id="f3378-203">(Cela peut sembler un peu intuitif dans un premier temps, mais il est judicieux si vous imaginez en prenant chaque fournisseur de la liste et leur empilement par-dessus les fournisseurs existants).</span><span class="sxs-lookup"><span data-stu-id="f3378-203">(This can seem a little counter-intuitive at first, but it makes sense if you imagine taking each provider out of the list and stacking it on top of the existing providers.)</span></span>

<span data-ttu-id="f3378-204">Ce classement généralement peu, car la plupart des services de fournisseur sont spécifiques au fournisseur et à la clé par le nom invariant du fournisseur.</span><span class="sxs-lookup"><span data-stu-id="f3378-204">This ordering usually doesn’t matter because most provider services are provider-specific and keyed by provider invariant name.</span></span> <span data-ttu-id="f3378-205">Toutefois, pour les services qui ne sont pas indexés par nom invariant du fournisseur ou certaines autres spécifique au fournisseur clé que le service sera résolu en fonction de cet ordre.</span><span class="sxs-lookup"><span data-stu-id="f3378-205">However, for services that are not keyed by provider invariant name or some other provider-specific key the service will be resolved based on this ordering.</span></span> <span data-ttu-id="f3378-206">Par exemple, si il n'est pas explicitement défini différemment à un endroit ; sinon, la fabrique de connexion par défaut proviendront à partir du fournisseur au premier plan dans la chaîne.</span><span class="sxs-lookup"><span data-stu-id="f3378-206">For example, if it is not explicitly set differently somewhere else, then the default connection factory will come from the topmost provider in the chain.</span></span>

## <a name="additional-config-file-registrations"></a><span data-ttu-id="f3378-207">Enregistrements de fichier de configuration supplémentaires</span><span class="sxs-lookup"><span data-stu-id="f3378-207">Additional config file registrations</span></span>

<span data-ttu-id="f3378-208">Il est possible de s’inscrire explicitement les services de fournisseur supplémentaires décrites ci-dessus directement dans le fichier de configuration d’une application.</span><span class="sxs-lookup"><span data-stu-id="f3378-208">It is possible to explicitly register some of the additional provider services described above directly in an application’s config file.</span></span> <span data-ttu-id="f3378-209">Lorsque cette opération s’effectue l’inscription dans le fichier de configuration sera utilisé au lieu de quoi que ce soit retourné par la méthode GetService de l’implémentation DbProviderServices.</span><span class="sxs-lookup"><span data-stu-id="f3378-209">When this is done the registration in the config file will be used instead of anything returned by the GetService method of the DbProviderServices implementation.</span></span>

### <a name="registering-the-default-connection-factory"></a><span data-ttu-id="f3378-210">Inscription de la fabrique de connexion par défaut</span><span class="sxs-lookup"><span data-stu-id="f3378-210">Registering the default connection factory</span></span>

<span data-ttu-id="f3378-211">Démarrage avec EF5 du package EntityFramework NuGet automatiquement inscrit la fabrique de connexion SQL Express ou de la fabrique de connexion de base de données locale dans le fichier de configuration.</span><span class="sxs-lookup"><span data-stu-id="f3378-211">Starting with EF5 the EntityFramework NuGet package automatically registered either the SQL Express connection factory or the LocalDb connection factory in the config file.</span></span>

<span data-ttu-id="f3378-212">Exemple :</span><span class="sxs-lookup"><span data-stu-id="f3378-212">For example:</span></span>

``` xml
<entityFramework>
  <defaultConnectionFactory type="System.Data.Entity.Infrastructure.SqlConnectionFactory, EntityFramework" >
</entityFramework>
```

<span data-ttu-id="f3378-213">Le _type_ est le nom de type qualifié d’assembly pour la fabrique de connexion par défaut, qui doit implémenter IDbConnectionFactory.</span><span class="sxs-lookup"><span data-stu-id="f3378-213">The _type_ is the assembly-qualified type name for the default connection factory, which must implement IDbConnectionFactory.</span></span>

<span data-ttu-id="f3378-214">Il est recommandé qu’un package NuGet du fournisseur défini la fabrique de connexion par défaut de cette manière lors de l’installation.</span><span class="sxs-lookup"><span data-stu-id="f3378-214">It is recommended that a provider NuGet package set the default connection factory in this way when installed.</span></span> <span data-ttu-id="f3378-215">Consultez _les Packages NuGet pour les fournisseurs_ ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="f3378-215">See _NuGet Packages for providers_ below.</span></span>

## <a name="additional-ef6-provider-changes"></a><span data-ttu-id="f3378-216">Modifications supplémentaires du fournisseur EF6</span><span class="sxs-lookup"><span data-stu-id="f3378-216">Additional EF6 provider changes</span></span>

### <a name="spatial-provider-changes"></a><span data-ttu-id="f3378-217">Modifications de fournisseur spatial</span><span class="sxs-lookup"><span data-stu-id="f3378-217">Spatial provider changes</span></span>

<span data-ttu-id="f3378-218">Fournisseurs qui prennent en charge les types de données spatiales doivent maintenant implémenter des méthodes supplémentaires sur les classes dérivées de DbSpatialDataReader :</span><span class="sxs-lookup"><span data-stu-id="f3378-218">Providers that support spatial types must now implement some additional methods on classes deriving from DbSpatialDataReader:</span></span>

*   `public abstract bool IsGeographyColumn(int ordinal)`
*   `public abstract bool IsGeometryColumn(int ordinal)`

<span data-ttu-id="f3378-219">Il existe également des nouvelles versions asynchrones des méthodes existantes qui sont recommandées pour être remplacée car les implémentations par défaut délèguent aux méthodes synchrones et par conséquent ne pas exécuter de façon asynchrone :</span><span class="sxs-lookup"><span data-stu-id="f3378-219">There are also new asynchronous versions of existing methods that are recommended to be overridden as the default implementations delegate to the synchronous methods and therefore do not execute asynchronously:</span></span>

*   `public virtual Task<DbGeography> GetGeographyAsync(int ordinal, CancellationToken cancellationToken)`
*   `public virtual Task<DbGeometry> GetGeometryAsync(int ordinal, CancellationToken cancellationToken)`

### <a name="native-support-for-enumerablecontains"></a><span data-ttu-id="f3378-220">Prise en charge native pour Enumerable.Contains</span><span class="sxs-lookup"><span data-stu-id="f3378-220">Native support for Enumerable.Contains</span></span>

<span data-ttu-id="f3378-221">EF6 introduit un nouveau type d’expression, DbInExpression, ce qui a été ajouté pour résoudre les problèmes de performances autour de l’utilisation de Enumerable.Contains dans les requêtes LINQ.</span><span class="sxs-lookup"><span data-stu-id="f3378-221">EF6 introduces a new expression type, DbInExpression, which was added to address performance issues around use of Enumerable.Contains in LINQ queries.</span></span> <span data-ttu-id="f3378-222">La classe DbProviderManifest a une nouvelle méthode virtuelle, SupportsInExpression, qui est appelée par EF pour déterminer si un fournisseur gère le nouveau type d’expression.</span><span class="sxs-lookup"><span data-stu-id="f3378-222">The DbProviderManifest class has a new virtual method, SupportsInExpression, which is called by EF to determine if a provider handles the new expression type.</span></span> <span data-ttu-id="f3378-223">Pour la compatibilité avec les implémentations de fournisseur existantes, la méthode retourne false.</span><span class="sxs-lookup"><span data-stu-id="f3378-223">For compatibility with existing provider implementations the method returns false.</span></span> <span data-ttu-id="f3378-224">Pour tirer parti de cette amélioration, un fournisseur d’EF6 pouvez ajouter du code pour gérer les DbInExpression et substituer SupportsInExpression pour retourner true.</span><span class="sxs-lookup"><span data-stu-id="f3378-224">To benefit from this improvement, an EF6 provider can add code to handle DbInExpression and override SupportsInExpression to return true.</span></span> <span data-ttu-id="f3378-225">Une instance de DbInExpression peut être créée en appelant la méthode DbExpressionBuilder.In.</span><span class="sxs-lookup"><span data-stu-id="f3378-225">An instance of DbInExpression can be created by calling the DbExpressionBuilder.In method.</span></span> <span data-ttu-id="f3378-226">Une instance de DbInExpression est composée d’une DbExpression, représentant généralement une colonne de table et une liste de DbConstantExpression à tester pour une correspondance.</span><span class="sxs-lookup"><span data-stu-id="f3378-226">A DbInExpression instance is composed of a DbExpression, usually representing a table column, and a list of DbConstantExpression to test for a match.</span></span>

## <a name="nuget-packages-for-providers"></a><span data-ttu-id="f3378-227">Packages NuGet pour les fournisseurs</span><span class="sxs-lookup"><span data-stu-id="f3378-227">NuGet packages for providers</span></span>

<span data-ttu-id="f3378-228">Première à proposer un fournisseur d’EF6 consiste à libérer sous forme de package NuGet.</span><span class="sxs-lookup"><span data-stu-id="f3378-228">One way to make an EF6 provider available is to release it as a NuGet package.</span></span> <span data-ttu-id="f3378-229">À l’aide d’un package NuGet présente les avantages suivants :</span><span class="sxs-lookup"><span data-stu-id="f3378-229">Using a NuGet package has the following advantages:</span></span>

*   <span data-ttu-id="f3378-230">Il est facile à utiliser NuGet pour ajouter l’inscription du fournisseur de fichier de configuration de l’application</span><span class="sxs-lookup"><span data-stu-id="f3378-230">It is easy to use NuGet to add the provider registration to the application’s config file</span></span>
*   <span data-ttu-id="f3378-231">Des modifications supplémentaires peuvent porter sur le fichier de configuration pour définir la fabrique de connexion par défaut afin que les connexions établies par convention utilise le fournisseur enregistré</span><span class="sxs-lookup"><span data-stu-id="f3378-231">Additional changes can be made to the config file to set the default connection factory so that connections made by convention will use the registered provider</span></span>
*   <span data-ttu-id="f3378-232">NuGet gère l’ajout des redirections de liaison afin que le fournisseur EF6 doit continuer à fonctionner même après la publication d’un nouveau package EF</span><span class="sxs-lookup"><span data-stu-id="f3378-232">NuGet handles adding binding redirects so that the EF6 provider should continue to work even after a new EF package is released</span></span>

<span data-ttu-id="f3378-233">Un exemple de ceci est le package EntityFramework.SqlServerCompact qui est inclus dans le [open source codebase](http://github.com/aspnet/entityframework6).</span><span class="sxs-lookup"><span data-stu-id="f3378-233">An example of this is the EntityFramework.SqlServerCompact package which is included in the [open source codebase](http://github.com/aspnet/entityframework6).</span></span> <span data-ttu-id="f3378-234">Ce package fournit un bon modèle pour créer des packages NuGet fournisseur EF.</span><span class="sxs-lookup"><span data-stu-id="f3378-234">This package provides a good template for creating EF provider NuGet packages.</span></span>

### <a name="powershell-commands"></a><span data-ttu-id="f3378-235">Commandes PowerShell</span><span class="sxs-lookup"><span data-stu-id="f3378-235">PowerShell commands</span></span>

<span data-ttu-id="f3378-236">Lorsque le package EntityFramework NuGet est installé, il inscrit un module PowerShell qui contient les deux commandes sont très utiles pour les packages de fournisseur :</span><span class="sxs-lookup"><span data-stu-id="f3378-236">When the EntityFramework NuGet package is installed it registers a PowerShell module that contains two commands that are very useful for provider packages:</span></span>

*   <span data-ttu-id="f3378-237">EFProvider ajouter ajoute une nouvelle entité pour le fournisseur dans le fichier de configuration du projet cible et s’assure qu’il est à la fin de la liste des fournisseurs inscrits.</span><span class="sxs-lookup"><span data-stu-id="f3378-237">Add-EFProvider adds a new entity for the provider in the target project’s configuration file and makes sure it is at the end of the list of registered providers.</span></span>
*   <span data-ttu-id="f3378-238">EFDefaultConnectionFactory ajouter ajoute ou met à jour l’inscription defaultconnectionfactory que dans le fichier de configuration du projet cible.</span><span class="sxs-lookup"><span data-stu-id="f3378-238">Add-EFDefaultConnectionFactory either adds or updates the defaultConnectionFactory registration in the target project’s configuration file.</span></span>

<span data-ttu-id="f3378-239">Ces deux commandes s’occuper de l’ajout d’une section entityFramework au fichier de configuration et l’ajout d’une collection de fournisseurs si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="f3378-239">Both these commands take care of adding an entityFramework section to the config file and adding a providers collection if necessary.</span></span>

<span data-ttu-id="f3378-240">Il est prévu que ces commandes être appelée à partir du script de NuGet Install.ps1.</span><span class="sxs-lookup"><span data-stu-id="f3378-240">It is intended that these commands be called from the install.ps1 NuGet script.</span></span> <span data-ttu-id="f3378-241">Par exemple, Install.ps1 pour le fournisseur SQL Compact ressemble à ceci :</span><span class="sxs-lookup"><span data-stu-id="f3378-241">For example, install.ps1 for the SQL Compact provider looks similar to this:</span></span>

``` powershell
param($installPath, $toolsPath, $package, $project)
Add-EFDefaultConnectionFactory $project 'System.Data.Entity.Infrastructure.SqlCeConnectionFactory, EntityFramework' -ConstructorArguments 'System.Data.SqlServerCe.4.0'
Add-EFProvider $project 'System.Data.SqlServerCe.4.0' 'System.Data.Entity.SqlServerCompact.SqlCeProviderServices, EntityFramework.SqlServerCompact'</pre>
```

<span data-ttu-id="f3378-242">Plus d’informations sur ces commandes peuvent être obtenus à l’aide de get-help dans la fenêtre de Console du Gestionnaire de Package.</span><span class="sxs-lookup"><span data-stu-id="f3378-242">More information about these commands can be obtained by using get-help in the Package Manager Console window.</span></span>

## <a name="wrapping-providers"></a><span data-ttu-id="f3378-243">Fournisseurs d’habillage</span><span class="sxs-lookup"><span data-stu-id="f3378-243">Wrapping providers</span></span>

<span data-ttu-id="f3378-244">Un fournisseur de retour à la ligne est un fournisseur EF et/ou ADO.NET qui encapsule un fournisseur existant à l’étendre avec d’autres fonctionnalités telles que le profilage ou le suivi des fonctionnalités.</span><span class="sxs-lookup"><span data-stu-id="f3378-244">A wrapping provider is an EF and/or ADO.NET provider that wraps an existing provider to extend it with other functionality such as profiling or tracing capabilities.</span></span> <span data-ttu-id="f3378-245">Fournisseurs d’habillage peut être inscrit de façon normale, mais il est souvent plus pratique pour configurer le fournisseur d’habillage lors de l’exécution en interceptant la résolution de liée au fournisseur de services.</span><span class="sxs-lookup"><span data-stu-id="f3378-245">Wrapping providers can be registered in the normal way, but it is often more convenient to setup the wrapping provider at runtime by intercepting the resolution of provider-related services.</span></span> <span data-ttu-id="f3378-246">L’événement statique OnLockingConfiguration sur la classe DbConfiguration peut être utilisé pour ce faire.</span><span class="sxs-lookup"><span data-stu-id="f3378-246">The static event OnLockingConfiguration on the DbConfiguration class can be used to do this.</span></span>

<span data-ttu-id="f3378-247">OnLockingConfiguration est appelée après que EF a déterminé où toute la configuration EF pour le domaine d’application est obtenus depuis mais avant d’être verrouillé pour une utilisation.</span><span class="sxs-lookup"><span data-stu-id="f3378-247">OnLockingConfiguration is called after EF has determined where all EF configuration for the app domain will be obtained from but before it is locked for use.</span></span> <span data-ttu-id="f3378-248">Au démarrage de l’application (avant EF est utilisé) l’application doit s’inscrire un gestionnaire d’événements pour cet événement.</span><span class="sxs-lookup"><span data-stu-id="f3378-248">At app startup (before EF is used) the app should register an event handler for this event.</span></span> <span data-ttu-id="f3378-249">(Nous envisageons d’ajouter la prise en charge de l’inscription de ce gestionnaire dans le fichier de configuration, mais cela n’est pas encore possible.) Le Gestionnaire d’événements doit ensuite effectuer un appel à ReplaceService pour chaque service qui doit être incluse.</span><span class="sxs-lookup"><span data-stu-id="f3378-249">(We are considering adding support for registering this handler in the config file but this is not yet supported.) The event handler should then make a call to ReplaceService for every service that needs to be wrapped.</span></span>  

<span data-ttu-id="f3378-250">Par exemple, pour encapsuler IDbConnectionFactory et DbProviderService, un gestionnaire comme celui-ci doit être inscrit :</span><span class="sxs-lookup"><span data-stu-id="f3378-250">For example, to wrap IDbConnectionFactory and DbProviderService, a handler something like this should be registered:</span></span>

``` csharp
DbConfiguration.OnLockingConfiguration +=
    (_, a) =>
    {
        a.ReplaceService<DbProviderServices>(
            (s, k) => new MyWrappedProviderServices(s));

        a.ReplaceService<IDbConnectionFactory>(
            (s, k) => new MyWrappedConnectionFactory(s));
    };
```

<span data-ttu-id="f3378-251">Le service qui a été résolu et doit maintenant être encapsulé avec la clé qui a été utilisée pour résoudre le service sont passés au gestionnaire.</span><span class="sxs-lookup"><span data-stu-id="f3378-251">The service that has been resolved and should now be wrapped together with the key that was used to resolve the service are passed to the handler.</span></span> <span data-ttu-id="f3378-252">Le gestionnaire peut encapsuler ce service, puis remplacez le service retourné par la version encapsulée.</span><span class="sxs-lookup"><span data-stu-id="f3378-252">The handler can then wrap this service and replace the returned service with the wrapped version.</span></span>

## <a name="resolving-a-dbproviderfactory-with-ef"></a><span data-ttu-id="f3378-253">Résolution d’un DbProviderFactory avec Entity Framework</span><span class="sxs-lookup"><span data-stu-id="f3378-253">Resolving a DbProviderFactory with EF</span></span>

<span data-ttu-id="f3378-254">DbProviderFactory est un des types de fournisseurs fondamentales nécessaires par Entity Framework, comme décrit dans la _présentation des types de fournisseur_ section ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="f3378-254">DbProviderFactory is one of the fundamental provider types needed by EF as described in the _Provider types overview_ section above.</span></span> <span data-ttu-id="f3378-255">Comme déjà mentionné, il n’est pas un type EF et l’inscription est généralement pas partie de la configuration d’EF, mais à la place l’inscription du fournisseur ADO.NET normale dans le fichier machine.config et/ou le fichier de configuration de l’application.</span><span class="sxs-lookup"><span data-stu-id="f3378-255">As already mentioned, It is not an EF type and registration is usually not part of EF configuration, but is instead the normal ADO.NET provider registration in the machine.config file and/or application’s config file.</span></span>

<span data-ttu-id="f3378-256">Malgré cette EF utilise toujours son mécanisme de résolution de dépendance normale lorsque vous recherchez un DbProviderFactory à utiliser.</span><span class="sxs-lookup"><span data-stu-id="f3378-256">Despite this EF still uses its normal dependency resolution mechanism when looking for a DbProviderFactory to use.</span></span> <span data-ttu-id="f3378-257">Le résolveur par défaut utilise l’inscription ADO.NET normale dans les fichiers de configuration et c’est généralement transparente.</span><span class="sxs-lookup"><span data-stu-id="f3378-257">The default resolver uses the normal ADO.NET registration in the config files and so this is usually transparent.</span></span> <span data-ttu-id="f3378-258">En raison de la résolution de dépendance normale mécanisme est utilisé, mais cela signifie qu’un IDbDependencyResolver peut être utilisé pour résoudre un DbProviderFactory même lorsque l’enregistrement normal de ADO.NET n’a pas été effectuée.</span><span class="sxs-lookup"><span data-stu-id="f3378-258">But because of the normal dependency resolution mechanism is used it means that an IDbDependencyResolver can be used to resolve a DbProviderFactory even when normal ADO.NET registration has not been done.</span></span>

<span data-ttu-id="f3378-259">Résolution DbProviderFactory de cette manière a plusieurs conséquences :</span><span class="sxs-lookup"><span data-stu-id="f3378-259">Resolving DbProviderFactory in this way has several implications:</span></span>

*   <span data-ttu-id="f3378-260">Une application à l’aide de la configuration basée sur le code peut ajouter des appels dans leur classe DbConfiguration pour inscrire la DbProviderFactory approprié.</span><span class="sxs-lookup"><span data-stu-id="f3378-260">An application using code-based configuration can add calls in their DbConfiguration class to register the appropriate DbProviderFactory.</span></span> <span data-ttu-id="f3378-261">Cela est particulièrement utile pour les applications qui ne souhaitent pas (ou ne peut pas) rendre tout utiliser de n’importe quelle configuration basée sur le fichier.</span><span class="sxs-lookup"><span data-stu-id="f3378-261">This is especially useful for applications that do not want to (or cannot) make use of any file-based configuration at all.</span></span>
*   <span data-ttu-id="f3378-262">Le service peut être encapsulé ou remplacé à l’aide de ReplaceService comme décrit dans la _encapsulant des fournisseurs_ section ci-dessus</span><span class="sxs-lookup"><span data-stu-id="f3378-262">The service can be wrapped or replaced using ReplaceService as described in the _Wrapping providers_ section above</span></span>
*   <span data-ttu-id="f3378-263">En théorie, une implémentation DbProviderServices pu résoudre un DbProviderFactory.</span><span class="sxs-lookup"><span data-stu-id="f3378-263">Theoretically, a DbProviderServices implementation could resolve a DbProviderFactory.</span></span>

<span data-ttu-id="f3378-264">Le point important à noter concernant effectuant l’une de ces éléments est qu’ils affectent uniquement la recherche de DbProviderFactory par Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="f3378-264">The important point to note about doing any of these things is that they will only affect the lookup of DbProviderFactory by EF.</span></span> <span data-ttu-id="f3378-265">Tout autre code non-EF peut s’attendent le fournisseur ADO.NET pour être inscrit de façon normale et risquent d’échouer si l’inscription est introuvable.</span><span class="sxs-lookup"><span data-stu-id="f3378-265">Other non-EF code may still expect the ADO.NET provider to be registered in the normal way and may fail if the registration is not found.</span></span> <span data-ttu-id="f3378-266">Pour cette raison, il est normalement préférable d’un DbProviderFactory à inscrire dans ADO.NET normalement.</span><span class="sxs-lookup"><span data-stu-id="f3378-266">For this reason it is normally better for a DbProviderFactory to be registered in the normal ADO.NET way.</span></span>

### <a name="related-services"></a><span data-ttu-id="f3378-267">Services associés</span><span class="sxs-lookup"><span data-stu-id="f3378-267">Related services</span></span>

<span data-ttu-id="f3378-268">Si Entity Framework est utilisé pour résoudre un DbProviderFactory, il doit également résoudre les services IProviderInvariantName et IDbProviderFactoryResolver.</span><span class="sxs-lookup"><span data-stu-id="f3378-268">If EF is used to resolve a DbProviderFactory, then it should also resolve the IProviderInvariantName and IDbProviderFactoryResolver services.</span></span>

<span data-ttu-id="f3378-269">IProviderInvariantName est un service qui est utilisé pour déterminer un nom invariant du fournisseur pour un type donné de DbProviderFactory.</span><span class="sxs-lookup"><span data-stu-id="f3378-269">IProviderInvariantName is a service that is used to determine a provider invariant name for a given type of DbProviderFactory.</span></span> <span data-ttu-id="f3378-270">L’implémentation par défaut de ce service utilise l’inscription du fournisseur ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="f3378-270">The default implementation of this service uses the ADO.NET provider registration.</span></span> <span data-ttu-id="f3378-271">Cela signifie que si le fournisseur ADO.NET n’est pas inscrit de façon normale, car DbProviderFactory est résolue par Entity Framework, puis il sera également nécessaire pour résoudre ce service.</span><span class="sxs-lookup"><span data-stu-id="f3378-271">This means that if the ADO.NET provider is not registered in the normal way because DbProviderFactory is being resolved by EF, then it will also be necessary to resolve this service.</span></span> <span data-ttu-id="f3378-272">Notez qu’un programme de résolution de ce service est automatiquement ajouté lorsque vous utilisez la méthode DbConfiguration.SetProviderFactory.</span><span class="sxs-lookup"><span data-stu-id="f3378-272">Note that a resolver for this service is automatically added when using the DbConfiguration.SetProviderFactory method.</span></span>

<span data-ttu-id="f3378-273">Comme décrit dans la _présentation des types de fournisseur_ ci-dessus, le IDbProviderFactoryResolver est utilisé pour obtenir la DbProviderFactory correct à partir d’un objet DbConnection donné.</span><span class="sxs-lookup"><span data-stu-id="f3378-273">As described in the _Provider types overview_ section above, the IDbProviderFactoryResolver is used to obtain the correct DbProviderFactory from a given DbConnection object.</span></span> <span data-ttu-id="f3378-274">L’implémentation par défaut de ce service lors de l’exécution sur .NET 4 utilise l’inscription du fournisseur ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="f3378-274">The default implementation of this service when running on .NET 4 uses the ADO.NET provider registration.</span></span> <span data-ttu-id="f3378-275">Cela signifie que si le fournisseur ADO.NET n’est pas inscrit de façon normale, car DbProviderFactory est résolue par Entity Framework, puis il sera également nécessaire pour résoudre ce service.</span><span class="sxs-lookup"><span data-stu-id="f3378-275">This means that if the ADO.NET provider is not registered in the normal way because DbProviderFactory is being resolved by EF, then it will also be necessary to resolve this service.</span></span>
