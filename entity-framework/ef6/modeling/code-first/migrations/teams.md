---
title: Code First Migrations dans les environnements d’équipe - EF6
author: divega
ms.date: 2016-10-23
ms.prod: entity-framework
ms.author: divega
ms.manager: avickers
ms.technology: entity-framework-6
ms.topic: article
ms.assetid: 4c2d9a95-de6f-4e97-9738-c1f8043eff69
caps.latest.revision: 3
ms.openlocfilehash: 6a29fe3ab3aa6b9a51bea54706490f143e860a48
ms.sourcegitcommit: bdd06c9a591ba5e6d6a3ec046c80de98f598f3f3
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/10/2018
ms.locfileid: "39121491"
---
# <a name="code-first-migrations-in-team-environments"></a><span data-ttu-id="4e197-102">Code First Migrations dans les environnements d’équipe</span><span class="sxs-lookup"><span data-stu-id="4e197-102">Code First Migrations in Team Environments</span></span>
> [!NOTE]
> <span data-ttu-id="4e197-103">Cet article suppose que vous savez comment utiliser Code First Migrations dans des scénarios de base.</span><span class="sxs-lookup"><span data-stu-id="4e197-103">This article assumes you know how to use Code First Migrations in basic scenarios.</span></span> <span data-ttu-id="4e197-104">Si vous n’avez pas, vous devez lire [Migrations Code First](~/ef6/modeling/code-first/migrations/index.md) avant de continuer.</span><span class="sxs-lookup"><span data-stu-id="4e197-104">If you don’t, then you’ll need to read [Code First Migrations](~/ef6/modeling/code-first/migrations/index.md) before continuing.</span></span>

## <a name="grab-a-coffee-you-need-to-read-this-whole-article"></a><span data-ttu-id="4e197-105">Prenez un café, vous devez lire cet article entier</span><span class="sxs-lookup"><span data-stu-id="4e197-105">Grab a coffee, you need to read this whole article</span></span>

<span data-ttu-id="4e197-106">Les problèmes dans les environnements d’équipe sont principalement autour de la fusion des migrations lorsque deux développeurs ont généré des migrations dans leur base de code local.</span><span class="sxs-lookup"><span data-stu-id="4e197-106">The issues in team environments are mostly around merging migrations when two developers have generated migrations in their local code base.</span></span> <span data-ttu-id="4e197-107">Alors que les étapes pour résoudre ces problèmes sont relativement simples, ils nécessitent que vous disposiez d’une connaissance approfondie du fonctionnement des migrations.</span><span class="sxs-lookup"><span data-stu-id="4e197-107">While the steps to solve these are pretty simple, they require you to have a solid understanding of how migrations works.</span></span> <span data-ttu-id="4e197-108">Ne pas simplement passer directement à la fin : prenez le temps de lire l’article complet pour garantir la que réussite de votre.</span><span class="sxs-lookup"><span data-stu-id="4e197-108">Please don’t just skip ahead to the end – take the time to read the whole article to ensure you are successful.</span></span>

## <a name="some-general-guidelines"></a><span data-ttu-id="4e197-109">Voici quelques directives générales</span><span class="sxs-lookup"><span data-stu-id="4e197-109">Some general guidelines</span></span>

<span data-ttu-id="4e197-110">Avant d’aller dans la gestion des migrations fusionnées générées par plusieurs développeurs, voici quelques indications générales pour garantir le succès.</span><span class="sxs-lookup"><span data-stu-id="4e197-110">Before we dig into how to manage merging migrations generated by multiple developers, here are some general guidelines to set you up for success.</span></span>

### <a name="each-team-member-should-have-a-local-development-database"></a><span data-ttu-id="4e197-111">Chaque membre de l’équipe doit avoir une base de données de développement local</span><span class="sxs-lookup"><span data-stu-id="4e197-111">Each team member should have a local development database</span></span>

<span data-ttu-id="4e197-112">Migrations utilise le  **\_ \_MigrationsHistory** table pour stocker les migrations qui ont été appliquées à la base de données.</span><span class="sxs-lookup"><span data-stu-id="4e197-112">Migrations uses the **\_\_MigrationsHistory** table to store what migrations have been applied to the database.</span></span> <span data-ttu-id="4e197-113">Si vous avez plusieurs développeurs générant des migrations différentes lors de la tentative de cibler la même base de données (et par conséquent partager une  **\_ \_MigrationsHistory** table) migrations va peu trouble.</span><span class="sxs-lookup"><span data-stu-id="4e197-113">If you have multiple developers generating different migrations while trying to target the same database (and thus share a **\_\_MigrationsHistory** table) migrations is going to get very confused.</span></span>

<span data-ttu-id="4e197-114">Bien sûr, si vous avez des membres de l’équipe qui ne sont pas générer des migrations, il n’est pas un problème que de les partager une base de données centrale de développement.</span><span class="sxs-lookup"><span data-stu-id="4e197-114">Of course, if you have team members that aren’t generating migrations, there is no problem having them share a central development database.</span></span>

### <a name="avoid-automatic-migrations"></a><span data-ttu-id="4e197-115">Évitez les migrations automatiques</span><span class="sxs-lookup"><span data-stu-id="4e197-115">Avoid automatic migrations</span></span>

<span data-ttu-id="4e197-116">Le point important est que les migrations automatiques initialement aspect dans les environnements d’équipe, mais en réalité qu’ils ne fonctionnent pas.</span><span class="sxs-lookup"><span data-stu-id="4e197-116">The bottom line is that automatic migrations initially look good in team environments, but in reality they just don’t work.</span></span> <span data-ttu-id="4e197-117">Si vous souhaitez savoir pourquoi, poursuivez votre lecture – si ce n’est pas, puis vous pouvez passer à la section suivante.</span><span class="sxs-lookup"><span data-stu-id="4e197-117">If you want to know why, keep reading – if not, then you can skip to the next section.</span></span>

<span data-ttu-id="4e197-118">Les migrations automatiques vous permet d’avoir votre schéma de base de données mis à jour pour faire correspondre le modèle actuel sans avoir besoin de générer des fichiers de code (basée sur le code de migrations).</span><span class="sxs-lookup"><span data-stu-id="4e197-118">Automatic migrations allows you to have your database schema updated to match the current model without the need to generate code files (code-based migrations).</span></span> <span data-ttu-id="4e197-119">Les migrations automatiques fonctionnerait très bien dans un environnement d’équipe si vous uniquement ne les a utilisés et jamais généré les migrations en code.</span><span class="sxs-lookup"><span data-stu-id="4e197-119">Automatic migrations would work very well in a team environment if you only ever used them and never generated any code-based migrations.</span></span> <span data-ttu-id="4e197-120">Le problème est que les migrations automatiques sont limitées et ne gèrent pas un nombre d’opérations de propriété/colonne renomme, le déplacement des données vers une autre table, etc. Pour gérer ces scénarios, vous vous retrouvez migrations basées sur le code de génération (et la modification du code généré automatiquement) qui sont mélangées entre les modifications qui sont gérés par les migrations automatiques.</span><span class="sxs-lookup"><span data-stu-id="4e197-120">The problem is that automatic migrations are limited and don’t handle a number of operations – property/column renames, moving data to another table, etc. To handle these scenarios you end up generating code-based migrations (and editing the scaffolded code) that are mixed in between changes that are handled by automatic migrations.</span></span> <span data-ttu-id="4e197-121">Cela rend près sur impossibles à fusionner les modifications lorsque deux développeurs archivent des migrations.</span><span class="sxs-lookup"><span data-stu-id="4e197-121">This makes it near on impossible to merge changes when two developers check in migrations.</span></span>

## <a name="screencasts"></a><span data-ttu-id="4e197-122">Captures d’écran</span><span class="sxs-lookup"><span data-stu-id="4e197-122">Screencasts</span></span>

<span data-ttu-id="4e197-123">Si vous surveille plutôt une capture vidéo à lire cet article, les deux vidéos suivantes couvrent le même contenu que cet article.</span><span class="sxs-lookup"><span data-stu-id="4e197-123">If you'd rather watch a screencast than read this article, the following two videos cover the same content as this article.</span></span>

### <a name="video-one-migrations---under-the-hood"></a><span data-ttu-id="4e197-124">Une vidéo : « Migrations - sous le capot »</span><span class="sxs-lookup"><span data-stu-id="4e197-124">Video One: "Migrations - Under the Hood"</span></span>

<span data-ttu-id="4e197-125">[Cette capture vidéo](http://channel9.msdn.com/blogs/ef/migrations-under-the-hood) couvre le mode de suivi des migrations et utilise les informations sur le modèle pour détecter les modifications apportées au modèle.</span><span class="sxs-lookup"><span data-stu-id="4e197-125">[This screencast](http://channel9.msdn.com/blogs/ef/migrations-under-the-hood) covers how migrations tracks and uses information about the model to detect model changes.</span></span>

### <a name="video-two-migrations---team-environments"></a><span data-ttu-id="4e197-126">Deux vidéo : « Migrations - environnements d’équipe »</span><span class="sxs-lookup"><span data-stu-id="4e197-126">Video Two: "Migrations - Team Environments"</span></span>

<span data-ttu-id="4e197-127">Création sur les concepts de la vidéo précédente, [cet enregistrement](http://channel9.msdn.com/blogs/ef/migrations-team-environments) couvre les problèmes qui surviennent dans un environnement d’équipe et comment les résoudre.</span><span class="sxs-lookup"><span data-stu-id="4e197-127">Building on the concepts from the previous video, [this screencast](http://channel9.msdn.com/blogs/ef/migrations-team-environments) covers the issues that arise in a team environment and how to solve them.</span></span>

## <a name="understanding-how-migrations-works"></a><span data-ttu-id="4e197-128">Comprendre le fonctionnement des migrations</span><span class="sxs-lookup"><span data-stu-id="4e197-128">Understanding how migrations works</span></span>

<span data-ttu-id="4e197-129">La clé pour utiliser correctement les migrations dans un environnement d’équipe est un présentation Comment suit les migrations de base et utilise les informations sur le modèle pour détecter les modifications apportées au modèle.</span><span class="sxs-lookup"><span data-stu-id="4e197-129">The key to successfully using migrations in a team environment is a basic understanding how migrations tracks and uses information about the model to detect model changes.</span></span>

### <a name="the-first-migration"></a><span data-ttu-id="4e197-130">La première migration</span><span class="sxs-lookup"><span data-stu-id="4e197-130">The first migration</span></span>

<span data-ttu-id="4e197-131">Lorsque vous ajoutez la première migration à votre projet, vous exécutez quelque chose comme **Add-Migration première** dans la Console du Gestionnaire de Package.</span><span class="sxs-lookup"><span data-stu-id="4e197-131">When you add the first migration to your project, you run something like **Add-Migration First** in Package Manager Console.</span></span> <span data-ttu-id="4e197-132">Les étapes de haut niveau qui exécute cette commande sont décrits ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="4e197-132">The high level steps that this command performs are pictured below.</span></span>

![FirstMigration](~/ef6/media/firstmigration.png)

<span data-ttu-id="4e197-134">Le modèle actuel est calculé à partir de votre code (1).</span><span class="sxs-lookup"><span data-stu-id="4e197-134">The current model is calculated from your code (1).</span></span> <span data-ttu-id="4e197-135">Les objets de base de données requis sont alors calculées par la différence de modèle (2) : dans la mesure où cela est la première migration du modèle diffèrent utilise simplement un modèle vide pour la comparaison.</span><span class="sxs-lookup"><span data-stu-id="4e197-135">The required database objects are then calculated by the model differ (2) – since this is the first migration the model differ just uses an empty model for the comparison.</span></span> <span data-ttu-id="4e197-136">Les modifications requises sont passées au Générateur de code pour générer le code de migration requises (3) qui est ensuite ajouté à votre solution Visual Studio (4).</span><span class="sxs-lookup"><span data-stu-id="4e197-136">The required changes are passed to the code generator to build the required migration code (3) which is then added to your Visual Studio solution (4).</span></span>

<span data-ttu-id="4e197-137">Outre le code de migration réelle qui est stocké dans le fichier de code principal, les migrations génère également certains fichiers code-behind supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="4e197-137">In addition to the actual migration code that is stored in the main code file, migrations also generates some additional code-behind files.</span></span> <span data-ttu-id="4e197-138">Ces fichiers sont des métadonnées qui sont utilisée par des migrations et ne sont pas quelque chose que vous devez modifier.</span><span class="sxs-lookup"><span data-stu-id="4e197-138">These files are metadata that is used by migrations and are not something you should edit.</span></span> <span data-ttu-id="4e197-139">Un de ces fichiers est un fichier de ressources (.resx) qui contient un instantané du modèle au moment de que la génération de la migration.</span><span class="sxs-lookup"><span data-stu-id="4e197-139">One of these files is a resource file (.resx) that contains a snapshot of the model at the time the migration was generated.</span></span> <span data-ttu-id="4e197-140">Vous verrez comment il est utilisé dans l’étape suivante.</span><span class="sxs-lookup"><span data-stu-id="4e197-140">You’ll see how this is used in the next step.</span></span>

<span data-ttu-id="4e197-141">À ce stade, vous exécutez probablement **Update-Database** pour appliquer vos modifications à la base de données, puis passez sur l’implémentation des autres zones de votre application.</span><span class="sxs-lookup"><span data-stu-id="4e197-141">At this point you would probably run **Update-Database** to apply your changes to the database, and then go about implementing other areas of your application.</span></span>

### <a name="subsequent-migrations"></a><span data-ttu-id="4e197-142">Des migrations</span><span class="sxs-lookup"><span data-stu-id="4e197-142">Subsequent migrations</span></span>

<span data-ttu-id="4e197-143">Plus tard, vous revenez et apportez des modifications à votre modèle : dans notre exemple, nous allons ajouter un **Url** propriété **Blog**.</span><span class="sxs-lookup"><span data-stu-id="4e197-143">Later you come back and make some changes to your model – in our example we’ll add a **Url** property to **Blog**.</span></span> <span data-ttu-id="4e197-144">Puis émettez une commande comme **Add-Migration AddUrl** pour générer automatiquement une migration pour appliquer la base de données change.</span><span class="sxs-lookup"><span data-stu-id="4e197-144">You would then issue a command such as **Add-Migration AddUrl** to scaffold a migration to apply the corresponding database changes.</span></span> <span data-ttu-id="4e197-145">Les étapes de haut niveau qui exécute cette commande sont décrits ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="4e197-145">The high level steps that this command performs are pictured below.</span></span>

![SecondMigration](~/ef6/media/secondmigration.png)

<span data-ttu-id="4e197-147">Tout comme la dernière fois, le modèle actuel est calculé à partir du code (1).</span><span class="sxs-lookup"><span data-stu-id="4e197-147">Just like last time, the current model is calculated from code (1).</span></span> <span data-ttu-id="4e197-148">Toutefois, cette fois, il existe des migrations existantes pour le modèle précédent est récupéré à partir de la dernière migration (2).</span><span class="sxs-lookup"><span data-stu-id="4e197-148">However, this time there are existing migrations so the previous model is retrieved from the latest migration (2).</span></span> <span data-ttu-id="4e197-149">Ces deux modèles sont comparés pour rechercher les modifications de base de données requis (3) et le processus effectue ensuite comme avant.</span><span class="sxs-lookup"><span data-stu-id="4e197-149">These two models are diffed to find the required database changes (3) and then the process completes as before.</span></span>

<span data-ttu-id="4e197-150">Ce même processus est utilisé pour les migrations supplémentaires que vous ajoutez au projet.</span><span class="sxs-lookup"><span data-stu-id="4e197-150">This same process is used for any further migrations that you add to the project.</span></span>

### <a name="why-bother-with-the-model-snapshot"></a><span data-ttu-id="4e197-151">Pourquoi s’embêter avec la capture instantanée du modèle ?</span><span class="sxs-lookup"><span data-stu-id="4e197-151">Why bother with the model snapshot?</span></span>

<span data-ttu-id="4e197-152">Vous vous demandez peut-être pourquoi EF dérange avec la capture instantanée du modèle – pourquoi pas simplement examiner la base de données.</span><span class="sxs-lookup"><span data-stu-id="4e197-152">You may be wondering why EF bothers with the model snapshot – why not just look at the database.</span></span> <span data-ttu-id="4e197-153">Dans ce cas, lisez la suite.</span><span class="sxs-lookup"><span data-stu-id="4e197-153">If so, read on.</span></span> <span data-ttu-id="4e197-154">Si vous ne souhaitez pas vous pouvez ignorer cette section.</span><span class="sxs-lookup"><span data-stu-id="4e197-154">If you’re not interested then you can skip this section.</span></span>

<span data-ttu-id="4e197-155">Il existe de nombreuses raisons QU'EF conserve la capture instantanée autour du modèle :</span><span class="sxs-lookup"><span data-stu-id="4e197-155">There are a number of reasons EF keeps the model snapshot around:</span></span>

-   <span data-ttu-id="4e197-156">Il permet à votre base de données à passer à partir du modèle Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="4e197-156">It allows your database to drift from the EF model.</span></span> <span data-ttu-id="4e197-157">Ces modifications peuvent être apportées directement dans la base de données, ou vous pouvez modifier le code généré automatiquement dans vos migrations pour apporter les modifications.</span><span class="sxs-lookup"><span data-stu-id="4e197-157">These changes can be made directly in the database, or you can change the scaffolded code in your migrations to make the changes.</span></span> <span data-ttu-id="4e197-158">Voici quelques exemples de cela en pratique :</span><span class="sxs-lookup"><span data-stu-id="4e197-158">Here are a couple of examples of this in practice:</span></span>
    -   <span data-ttu-id="4e197-159">Vous souhaitez ajouter une Inserted et la mise à jour pour la colonne à un ou plusieurs de vos tables, mais vous ne souhaitez pas inclure ces colonnes dans le modèle EF.</span><span class="sxs-lookup"><span data-stu-id="4e197-159">You want to add an Inserted and Updated to column to one or more of your tables but you don’t want to include these columns in the EF model.</span></span> <span data-ttu-id="4e197-160">Si les migrations examiné la base de données que s’il s’agissait en permanence essayez de supprimer ces colonnes chaque fois que vous généré automatiquement une migration.</span><span class="sxs-lookup"><span data-stu-id="4e197-160">If migrations looked at the database it would continually try to drop these columns every time you scaffolded a migration.</span></span> <span data-ttu-id="4e197-161">À l’aide de la capture instantanée du modèle, EF uniquement jamais détecte des modifications légitimes portées au modèle.</span><span class="sxs-lookup"><span data-stu-id="4e197-161">Using the model snapshot, EF will only ever detect legitimate changes to the model.</span></span>
    -   <span data-ttu-id="4e197-162">Vous souhaitez modifier le corps d’une procédure stockée utilisée pour les mises à jour pour inclure une journalisation.</span><span class="sxs-lookup"><span data-stu-id="4e197-162">You want to change the body of a stored procedure used for updates to include some logging.</span></span> <span data-ttu-id="4e197-163">Si les migrations étudié cette procédure stockée à partir de la base de données en permanence tentait de rétablir la définition qui attend d’EF.</span><span class="sxs-lookup"><span data-stu-id="4e197-163">If migrations looked at this stored procedure from the database it would continually try and reset it back to the definition that EF expects.</span></span> <span data-ttu-id="4e197-164">À l’aide de la capture instantanée du modèle, EF sera structurer uniquement jamais de code pour modifier la procédure stockée lorsque vous modifiez la forme de la procédure décrite dans le modèle EF.</span><span class="sxs-lookup"><span data-stu-id="4e197-164">By using the model snapshot, EF will only ever scaffold code to alter the stored procedure when you change the shape of the procedure in the EF model.</span></span>
    -   <span data-ttu-id="4e197-165">Ces mêmes principes s’appliquent à l’ajout d’index supplémentaires, y compris les tables supplémentaires dans votre base de données, mappage EF à une vue de base de données qui se trouve sur une table, etc.</span><span class="sxs-lookup"><span data-stu-id="4e197-165">These same principles apply to adding extra indexes, including extra tables in your database, mapping EF to a database view that sits over a table, etc.</span></span>
-   <span data-ttu-id="4e197-166">Le modèle EF contient plus que la forme de la base de données.</span><span class="sxs-lookup"><span data-stu-id="4e197-166">The EF model contains more than just the shape of the database.</span></span> <span data-ttu-id="4e197-167">L’ensemble du modèle permet de migrations d’examiner des informations sur les propriétés et les classes dans votre modèle et comment elles correspondent aux colonnes et des tables.</span><span class="sxs-lookup"><span data-stu-id="4e197-167">Having the entire model allows migrations to look at information about the properties and classes in your model and how they map to the columns and tables.</span></span> <span data-ttu-id="4e197-168">Ces informations permettent à être plus intelligentes dans le code il structure les migrations.</span><span class="sxs-lookup"><span data-stu-id="4e197-168">This information allows migrations to be more intelligent in the code that it scaffolds.</span></span> <span data-ttu-id="4e197-169">Par exemple, si vous modifiez le nom de la colonne qui a une propriété est mappée aux migrations peut détecter le changement de nom en fait de constater qu’il est la même propriété – quelque chose qui ne peut pas être effectuée si vous avez uniquement le schéma de base de données.</span><span class="sxs-lookup"><span data-stu-id="4e197-169">For example, if you change the name of the column that a property maps to migrations can detect the rename by seeing that it’s the same property – something that can’t be done if you only have the database schema.</span></span> 

## <a name="what-causes-issues-in-team-environments"></a><span data-ttu-id="4e197-170">Ce qui provoque des problèmes dans les environnements d’équipe</span><span class="sxs-lookup"><span data-stu-id="4e197-170">What causes issues in team environments</span></span>

<span data-ttu-id="4e197-171">Le flux de travail traités dans la précédente fonctionne de section parfaitement lorsque vous êtes un développeur unique qui travaille sur une application.</span><span class="sxs-lookup"><span data-stu-id="4e197-171">The workflow covered in the previous section works great when you are a single developer working on an application.</span></span> <span data-ttu-id="4e197-172">Elle fonctionne également bien dans un environnement d’équipe si vous êtes la seule personne à apporter des modifications au modèle.</span><span class="sxs-lookup"><span data-stu-id="4e197-172">It also works well in a team environment if you are the only person making changes to the model.</span></span> <span data-ttu-id="4e197-173">Dans ce scénario, vous pouvez apporter des modifications de modèle, générer des migrations et les envoyer à votre contrôle de code source.</span><span class="sxs-lookup"><span data-stu-id="4e197-173">In this scenario you can make model changes, generate migrations and submit them to your source control.</span></span> <span data-ttu-id="4e197-174">D’autres développeurs peuvent synchroniser vos modifications et exécutez **Update-Database** pour que les modifications de schéma appliquées.</span><span class="sxs-lookup"><span data-stu-id="4e197-174">Other developers can sync your changes and run **Update-Database** to have the schema changes applied.</span></span>

<span data-ttu-id="4e197-175">Problèmes commencent à se produire lorsque vous avez plusieurs développeurs apporter des modifications au modèle EF et envoi au contrôle de code source en même temps.</span><span class="sxs-lookup"><span data-stu-id="4e197-175">Issues start to arise when you have multiple developers making changes to the EF model and submitting to source control at the same time.</span></span> <span data-ttu-id="4e197-176">Qu’EF ne dispose pas d’est un moyen de première classe pour fusionner vos migrations locales avec les migrations un autre développeur a soumis au contrôle de code source depuis la dernière synchronisation.</span><span class="sxs-lookup"><span data-stu-id="4e197-176">What EF lacks is a first class way to merge your local migrations with migrations that another developer has submitted to source control since you last synced.</span></span>

## <a name="an-example-of-a-merge-conflict"></a><span data-ttu-id="4e197-177">Un exemple d’un conflit de fusion</span><span class="sxs-lookup"><span data-stu-id="4e197-177">An example of a merge conflict</span></span>

<span data-ttu-id="4e197-178">Première Examinons un exemple concret de conflit de fusion.</span><span class="sxs-lookup"><span data-stu-id="4e197-178">First let’s look at a concrete example of such a merge conflict.</span></span> <span data-ttu-id="4e197-179">Nous allons continuer sur avec l’exemple que nous avons vu précédemment.</span><span class="sxs-lookup"><span data-stu-id="4e197-179">We’ll continue on with the example we looked at earlier.</span></span> <span data-ttu-id="4e197-180">Nous allons commencer à point supposent les modifications à partir de la section précédente ont été archivées par le développeur d’origine.</span><span class="sxs-lookup"><span data-stu-id="4e197-180">As a starting point let’s assume the changes from the previous section were checked in by the original developer.</span></span> <span data-ttu-id="4e197-181">Nous allons suivre deux développeurs quand ils apportent des modifications au code base.</span><span class="sxs-lookup"><span data-stu-id="4e197-181">We’ll track two developers as they make changes to code base.</span></span>

<span data-ttu-id="4e197-182">Nous allons suivre le modèle EF et les migrations à un nombre de modifications.</span><span class="sxs-lookup"><span data-stu-id="4e197-182">We’ll track the EF model and the migrations thru a number of changes.</span></span> <span data-ttu-id="4e197-183">Pour un point de départ, les développeurs ont synchronisé dans le référentiel de contrôle source, comme illustré dans le graphique suivant.</span><span class="sxs-lookup"><span data-stu-id="4e197-183">For a starting point, both developers have synced to the source control repository, as depicted in the following graphic.</span></span>

![StartingPoint](~/ef6/media/startingpoint.png)

<span data-ttu-id="4e197-185">Développeur \#1 et développeur \#2 désormais apporte des modifications au modèle EF dans leur code local base.</span><span class="sxs-lookup"><span data-stu-id="4e197-185">Developer \#1 and developer \#2 now makes some changes to the EF model in their local code base.</span></span> <span data-ttu-id="4e197-186">Développeur \#1 ajoute un **évaluation** propriété **Blog** – et génère une **AddRating** migration pour appliquer les modifications à la base de données.</span><span class="sxs-lookup"><span data-stu-id="4e197-186">Developer \#1 adds a **Rating** property to **Blog** – and generates an **AddRating** migration to apply the changes to the database.</span></span> <span data-ttu-id="4e197-187">Développeur \#2 ajoute un **lecteurs** propriété **Blog** – et génère le correspondantes **AddReaders** migration.</span><span class="sxs-lookup"><span data-stu-id="4e197-187">Developer \#2 adds a **Readers** property to **Blog** – and generates the corresponding **AddReaders** migration.</span></span> <span data-ttu-id="4e197-188">Les développeurs exécutaient **Update-Database**, pour appliquer les modifications à leurs bases de données locales, puis continuer le développement de l’application.</span><span class="sxs-lookup"><span data-stu-id="4e197-188">Both developers run **Update-Database**, to apply the changes to their local databases, and then continue developing the application.</span></span>

> [!NOTE]
> <span data-ttu-id="4e197-189">Migrations sont précédées avec un horodatage, de sorte que notre graphique représente que la migration AddReaders développeur \#2 vient après la migration AddRating développeur \#1.</span><span class="sxs-lookup"><span data-stu-id="4e197-189">Migrations are prefixed with a timestamp, so our graphic represents that the AddReaders migration from Developer \#2 comes after the AddRating migration from Developer \#1.</span></span> <span data-ttu-id="4e197-190">Si développeur \#1 ou \#2 ne généré aucune différence pour les problèmes de l’utilisation dans une équipe, ou le processus de fusion que nous allons examiner dans la section suivante d’effectuer de la première migration.</span><span class="sxs-lookup"><span data-stu-id="4e197-190">Whether developer \#1 or \#2 generated the migration first makes no difference to the issues of working in a team, or the process for merging them that we’ll look at in the next section.</span></span>

![LocalChanges](~/ef6/media/localchanges.png)

<span data-ttu-id="4e197-192">C’est un jour chance pour développeur \#1 qu’elles se produisent à soumettre leurs modifications tout d’abord.</span><span class="sxs-lookup"><span data-stu-id="4e197-192">It’s a lucky day for Developer \#1 as they happen to submit their changes first.</span></span> <span data-ttu-id="4e197-193">Car aucune autre personne a archivé dans la mesure où ils synchronisés son référentiel, ils peuvent simplement les soumettre leurs modifications sans effectuer toute fusion.</span><span class="sxs-lookup"><span data-stu-id="4e197-193">Because no one else has checked in since they synced their repository, they can just submit their changes without performing any merging.</span></span>

![Envoyer](~/ef6/media/submit.png)

<span data-ttu-id="4e197-195">Maintenant il est temps pour développeur \#2 à envoyer.</span><span class="sxs-lookup"><span data-stu-id="4e197-195">Now it’s time for Developer \#2 to submit.</span></span> <span data-ttu-id="4e197-196">Ils ne sont pas donc chance.</span><span class="sxs-lookup"><span data-stu-id="4e197-196">They aren’t so lucky.</span></span> <span data-ttu-id="4e197-197">Étant donné que quelqu'un d’autre a soumis des modifications dans la mesure où ils synchronisés, ils doivent extraire les modifications et la fusion.</span><span class="sxs-lookup"><span data-stu-id="4e197-197">Because someone else has submitted changes since they synced, they will need to pull down the changes and merge.</span></span> <span data-ttu-id="4e197-198">Le système de contrôle de code source sera probablement être en mesure de fusionner automatiquement les modifications au niveau du code dans la mesure où ils sont très simples.</span><span class="sxs-lookup"><span data-stu-id="4e197-198">The source control system will likely be able to automatically merge the changes at the code level since they are very simple.</span></span> <span data-ttu-id="4e197-199">L’état de développeur \#local de 2 référentiel après la synchronisation est représentée dans le graphique suivant.</span><span class="sxs-lookup"><span data-stu-id="4e197-199">The state of Developer \#2’s local repository after syncing is depicted in the following graphic.</span></span> 

![Extraction](~/ef6/media/pull.png)

<span data-ttu-id="4e197-201">À ce stade développeur \#2 peuvent exécuter **Update-Database** qui détectera la nouvelle **AddRating** migration (qui n’a pas été appliqué au développeur \#2 base de données) et l’appliquer.</span><span class="sxs-lookup"><span data-stu-id="4e197-201">At this stage Developer \#2 can run **Update-Database** which will detect the new **AddRating** migration (which hasn’t been applied to Developer \#2’s database) and apply it.</span></span> <span data-ttu-id="4e197-202">Maintenant le **évaluation** colonne est ajoutée à la **Blogs** table et la base de données est synchronisée avec le modèle.</span><span class="sxs-lookup"><span data-stu-id="4e197-202">Now the **Rating** column is added to the **Blogs** table and the database is in sync with the model.</span></span>

<span data-ttu-id="4e197-203">Il existe cependant deux problèmes :</span><span class="sxs-lookup"><span data-stu-id="4e197-203">There are a couple of problems though:</span></span>

1.  <span data-ttu-id="4e197-204">Bien que **Update-Database** appliquera la **AddRating** migration elle déclenche également un avertissement : *Impossible de mettre à jour de la base de données pour faire correspondre le modèle actuel, car les modifications en attente et migration automatique est désactivée...*</span><span class="sxs-lookup"><span data-stu-id="4e197-204">Although **Update-Database** will apply the **AddRating** migration it will also raise a warning: *Unable to update database to match the current model because there are pending changes and automatic migration is disabled…*</span></span>
    <span data-ttu-id="4e197-205">Le problème est que la capture instantanée du modèle est stocké dans la dernière migration (**AddReader**) n’a pas la **évaluation** propriété sur **Blog** (dans la mesure où il ne fasse pas partie du modèle lors de la migration a été générée).</span><span class="sxs-lookup"><span data-stu-id="4e197-205">The problem is that the model snapshot stored in the last migration (**AddReader**) is missing the **Rating** property on **Blog** (since it wasn’t part of the model when the migration was generated).</span></span> <span data-ttu-id="4e197-206">Tout d’abord, le code détecte que le modèle dans la dernière migration ne correspond pas au modèle actuel et déclenche l’avertissement.</span><span class="sxs-lookup"><span data-stu-id="4e197-206">Code First detects that the model in the last migration doesn’t match the current model and raises the warning.</span></span>
2.  <span data-ttu-id="4e197-207">Exécution de l’application entraînera une exception InvalidOperationException indiquant que «*le modèle soutient le contexte 'BloggingContext' a changé depuis la création de la base de données. Envisagez d’utiliser des Migrations Code First pour mettre à jour de la base de données... »*</span><span class="sxs-lookup"><span data-stu-id="4e197-207">Running the application would result in an InvalidOperationException stating that “*The model backing the 'BloggingContext' context has changed since the database was created. Consider using Code First Migrations to update the database…”*</span></span>
    <span data-ttu-id="4e197-208">Là encore, le problème est la capture instantanée du modèle stockée dans la dernière migration ne correspond pas au modèle actuel.</span><span class="sxs-lookup"><span data-stu-id="4e197-208">Again, the problem is the model snapshot stored in the last migration doesn’t match the current model.</span></span>
3.  <span data-ttu-id="4e197-209">Enfin, nous pouvons prévoir en cours d’exécution **Add-Migration** maintenant générerait une migration vide (dans la mesure où il n’y a aucune modification à appliquer à la base de données).</span><span class="sxs-lookup"><span data-stu-id="4e197-209">Finally, we would expect running **Add-Migration** now would generate an empty migration (since there are no changes to apply to the database).</span></span> <span data-ttu-id="4e197-210">Mais étant donné que les migrations compare le modèle actuel à celui de la dernière migration (qui manque le **évaluation** propriété) il sera réellement structurer un autre **AddColumn** appel visant à ajouter dans le **Évaluation** colonne.</span><span class="sxs-lookup"><span data-stu-id="4e197-210">But because migrations compares the current model to the one from the last migration (which is missing the **Rating** property) it will actually scaffold another **AddColumn** call to add in the **Rating** column.</span></span> <span data-ttu-id="4e197-211">Bien sûr, cette migration échouerait pendant **Update-Database** , car le **évaluation** colonne existe déjà.</span><span class="sxs-lookup"><span data-stu-id="4e197-211">Of course, this migration would fail during **Update-Database** because the **Rating** column already exists.</span></span>

## <a name="resolving-the-merge-conflict"></a><span data-ttu-id="4e197-212">Résolution du conflit de fusion</span><span class="sxs-lookup"><span data-stu-id="4e197-212">Resolving the merge conflict</span></span>

<span data-ttu-id="4e197-213">La bonne nouvelle est qu’il n’est pas trop difficile à gérer avec la fusion manuelle : fournies vous avez une compréhension du fonctionnement des migrations.</span><span class="sxs-lookup"><span data-stu-id="4e197-213">The good news is that it’s not too hard to deal with the merge manually – provided you have an understanding of how migrations works.</span></span> <span data-ttu-id="4e197-214">Par conséquent, si vous avez ignoré à l’avance à cette section...</span><span class="sxs-lookup"><span data-stu-id="4e197-214">So if you’ve skipped ahead to this section…</span></span> <span data-ttu-id="4e197-215">Nous sommes désolés, vous devez revenir en arrière et lire le reste de l’article tout d’abord !</span><span class="sxs-lookup"><span data-stu-id="4e197-215">sorry, you need to go back and read the rest of the article first!</span></span>

<span data-ttu-id="4e197-216">Il existe deux options, la plus simple consiste à générer une migration vide qui contient le modèle correct actuel en tant qu’instantané.</span><span class="sxs-lookup"><span data-stu-id="4e197-216">There are two options, the easiest is to generate a blank migration that has the correct current model as a snapshot.</span></span> <span data-ttu-id="4e197-217">La deuxième option consiste à mettre à jour de la capture instantanée dans la dernière migration pour avoir le bon capture instantanée du modèle.</span><span class="sxs-lookup"><span data-stu-id="4e197-217">The second option is to update the snapshot in the last migration to have the correct model snapshot.</span></span> <span data-ttu-id="4e197-218">La deuxième option est un peu plus difficile et ne peut pas être utilisée dans tous les scénarios, mais il est également plus propre, car il n’implique l’ajout d’une migration supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="4e197-218">The second option is a little harder and can’t be used in every scenario, but it’s also cleaner because it doesn’t involve adding an extra migration.</span></span>

### <a name="option-1-add-a-blank-merge-migration"></a><span data-ttu-id="4e197-219">Option 1 : Ajouter une migration vide « fusionner »</span><span class="sxs-lookup"><span data-stu-id="4e197-219">Option 1: Add a blank ‘merge’ migration</span></span>

<span data-ttu-id="4e197-220">Dans cette option, nous générons une migration vide uniquement afin de s’assurer de la dernière migration a l’instantané de modèle approprié stockées qu’il contient.</span><span class="sxs-lookup"><span data-stu-id="4e197-220">In this option we generate a blank migration solely for the purpose of making sure the latest migration has the correct model snapshot stored in it.</span></span>

<span data-ttu-id="4e197-221">Cette option peut être utilisée indépendamment de ce qui a généré la dernière migration.</span><span class="sxs-lookup"><span data-stu-id="4e197-221">This option can be used regardless of who generated the last migration.</span></span> <span data-ttu-id="4e197-222">Dans l’exemple que nous avons effectué les développeurs \#2 est prise en charge de la fusion et ils se produisent pour générer la dernière migration.</span><span class="sxs-lookup"><span data-stu-id="4e197-222">In the example we’ve been following Developer \#2 is taking care of the merge and they happened to generate the last migration.</span></span> <span data-ttu-id="4e197-223">Mais ces mêmes étapes peuvent être utilisées si développeur \#1 généré la dernière migration.</span><span class="sxs-lookup"><span data-stu-id="4e197-223">But these same steps can be used if Developer \#1 generated the last migration.</span></span> <span data-ttu-id="4e197-224">Les étapes s’appliquent également si plusieurs migrations sont impliqués : nous avons été en train d’utiliser deux pour faire simple.</span><span class="sxs-lookup"><span data-stu-id="4e197-224">The steps also apply if there are multiple migrations involved – we’ve just been looking at two in order to keep it simple.</span></span>

<span data-ttu-id="4e197-225">Le processus suivant peut être utilisé pour cette approche, à partir du moment que vous réalisez que vous avez des modifications qui doivent être synchronisés à partir du contrôle de code source.</span><span class="sxs-lookup"><span data-stu-id="4e197-225">The following process can be used for this approach, starting from the time you realize you have changes that need to be synced from source control.</span></span>

1.  <span data-ttu-id="4e197-226">Vérifiez que toutes les modifications en attente de modèle dans votre base de code local ont été écrits dans une migration.</span><span class="sxs-lookup"><span data-stu-id="4e197-226">Ensure any pending model changes in your local code base have been written to a migration.</span></span> <span data-ttu-id="4e197-227">Cette étape garantit que vous ne manquez pas les modifications légitimes lorsqu’il s’agit de la génération de la migration vide.</span><span class="sxs-lookup"><span data-stu-id="4e197-227">This step ensures you don’t miss any legitimate changes when it comes time to generate the blank migration.</span></span>
2.  <span data-ttu-id="4e197-228">Synchroniser avec le contrôle de code source.</span><span class="sxs-lookup"><span data-stu-id="4e197-228">Sync with source control.</span></span>
3.  <span data-ttu-id="4e197-229">Exécutez **Update-Database** pour appliquer les migrations de nouveau les autres développeurs ont archivé.</span><span class="sxs-lookup"><span data-stu-id="4e197-229">Run **Update-Database** to apply any new migrations that other developers have checked in.</span></span>
    <span data-ttu-id="4e197-230">\*\*
    *Remarque : \*\*\* Si vous n’obtenez pas les avertissements à partir de la commande Update-Database ne comportait aucune nouvelle migration à partir d’autres développeurs et il est inutile d’effectuer toute fusion.*</span><span class="sxs-lookup"><span data-stu-id="4e197-230">**
*Note:****if you don’t get any warnings from the Update-Database command then there were no new migrations from other developers and there is no need to perform any further merging.*</span></span>
4.  <span data-ttu-id="4e197-231">Exécutez **Add-Migration &lt;choisir\_un\_nom&gt; – IgnoreChanges** (par exemple, **Add-Migration de fusion – IgnoreChanges**).</span><span class="sxs-lookup"><span data-stu-id="4e197-231">Run **Add-Migration &lt;pick\_a\_name&gt; –IgnoreChanges** (for example, **Add-Migration Merge –IgnoreChanges**).</span></span> <span data-ttu-id="4e197-232">Cela génère une migration avec toutes les métadonnées (y compris un instantané du modèle actif), mais ignore les modifications qu’il détecte lors de la comparaison du modèle actif pour la capture instantanée dans les migrations dernière (ce qui signifie que vous obtenez une valeur vide **des** et **Vers le bas** méthode).</span><span class="sxs-lookup"><span data-stu-id="4e197-232">This generates a migration with all the metadata (including a snapshot of the current model) but will ignore any changes it detects when comparing the current model to the snapshot in the last migrations (meaning you get a blank **Up** and **Down** method).</span></span>
5.  <span data-ttu-id="4e197-233">Continuer à développer ou les envoyer au contrôle de code source (après que exécution votre de tests unitaires bien entendu).</span><span class="sxs-lookup"><span data-stu-id="4e197-233">Continue developing, or submit to source control (after running your unit tests of course).</span></span>

<span data-ttu-id="4e197-234">Voici l’état de développeur \#local de 2 code base après l’utilisation de cette approche.</span><span class="sxs-lookup"><span data-stu-id="4e197-234">Here is the state of Developer \#2’s local code base after using this approach.</span></span>

![MergeMigration](~/ef6/media/mergemigration.png)

### <a name="option-2-update-the-model-snapshot-in-the-last-migration"></a><span data-ttu-id="4e197-236">Option 2 : Mettre à jour la capture instantanée du modèle dans la dernière migration</span><span class="sxs-lookup"><span data-stu-id="4e197-236">Option 2: Update the model snapshot in the last migration</span></span>

<span data-ttu-id="4e197-237">Cette option est très similaire à l’option 1, mais supprime la migration vierge supplémentaires – car Admettons-le, qui souhaite les fichiers de code supplémentaire dans leur solution.</span><span class="sxs-lookup"><span data-stu-id="4e197-237">This option is very similar to option 1 but removes the extra blank migration – because let’s face it, who wants extra code files in their solution.</span></span>

<span data-ttu-id="4e197-238">**Cette approche est uniquement possible si la migration la plus récente existe uniquement dans votre base de code local et le n'a pas encore été soumise au contrôle de code source (par exemple, si la dernière migration a été générée par l’utilisateur qui effectue la fusion)**.</span><span class="sxs-lookup"><span data-stu-id="4e197-238">**This approach is only feasible if the latest migration exists only in your local code base and has not yet been submitted to source control (for example, if the last migration was generated by the user doing the merge)**.</span></span> <span data-ttu-id="4e197-239">Modifier les métadonnées des migrations autres développeurs déjà appliqués à leur base de données de développement – ou encore pire appliqué à une base de données de production – peut entraîner des effets secondaires inattendus.</span><span class="sxs-lookup"><span data-stu-id="4e197-239">Editing the metadata of migrations that other developers may have already applied to their development database – or even worse applied to a production database – can result in unexpected side effects.</span></span> <span data-ttu-id="4e197-240">Au cours du processus, nous allons restaurer la dernière migration dans notre base de données locale et réappliquez avec les métadonnées mises à jour.</span><span class="sxs-lookup"><span data-stu-id="4e197-240">During the process we’re going to roll back the last migration in our local database and re-apply it with updated metadata.</span></span>

<span data-ttu-id="4e197-241">Bien que la dernière migration doit juste être dans le code local base, il n’existe aucune restriction pour le nombre ou l’ordre des migrations qui il continuer.</span><span class="sxs-lookup"><span data-stu-id="4e197-241">While the last migration needs to just be in the local code base there are no restrictions to the number or order of migrations that proceed it.</span></span> <span data-ttu-id="4e197-242">Il peut y avoir plusieurs migrations à partir de plusieurs développeurs différents et les mêmes étapes s’appliquent : nous avons été en train d’utiliser deux pour faire simple.</span><span class="sxs-lookup"><span data-stu-id="4e197-242">There can be multiple migrations from multiple different developers and the same steps apply– we’ve just been looking at two in order to keep it simple.</span></span>

<span data-ttu-id="4e197-243">Le processus suivant peut être utilisé pour cette approche, à partir du moment que vous réalisez que vous avez des modifications qui doivent être synchronisés à partir du contrôle de code source.</span><span class="sxs-lookup"><span data-stu-id="4e197-243">The following process can be used for this approach, starting from the time you realize you have changes that need to be synced from source control.</span></span>

1.  <span data-ttu-id="4e197-244">Vérifiez que toutes les modifications en attente de modèle dans votre base de code local ont été écrits dans une migration.</span><span class="sxs-lookup"><span data-stu-id="4e197-244">Ensure any pending model changes in your local code base have been written to a migration.</span></span> <span data-ttu-id="4e197-245">Cette étape garantit que vous ne manquez pas les modifications légitimes lorsqu’il s’agit de la génération de la migration vide.</span><span class="sxs-lookup"><span data-stu-id="4e197-245">This step ensures you don’t miss any legitimate changes when it comes time to generate the blank migration.</span></span>
2.  <span data-ttu-id="4e197-246">Synchroniser avec le contrôle de code source.</span><span class="sxs-lookup"><span data-stu-id="4e197-246">Sync with the source control.</span></span>
3.  <span data-ttu-id="4e197-247">Exécutez **Update-Database** pour appliquer les migrations de nouveau les autres développeurs ont archivé.</span><span class="sxs-lookup"><span data-stu-id="4e197-247">Run **Update-Database** to apply any new migrations that other developers have checked in.</span></span>
    <span data-ttu-id="4e197-248">\*\*
    *Remarque : \*\*\* Si vous n’obtenez pas les avertissements à partir de la commande Update-Database ne comportait aucune nouvelle migration à partir d’autres développeurs et il est inutile d’effectuer toute fusion.*</span><span class="sxs-lookup"><span data-stu-id="4e197-248">**
*Note:****if you don’t get any warnings from the Update-Database command then there were no new migrations from other developers and there is no need to perform any further merging.*</span></span>
4.  <span data-ttu-id="4e197-249">Exécutez **mise à jour la base de données – TargetMigration &lt;deuxième\_dernière\_migration&gt;**  (dans l’exemple que nous avons été suivant ce serait **Update-Database : TargetMigration AddRating**).</span><span class="sxs-lookup"><span data-stu-id="4e197-249">Run **Update-Database –TargetMigration &lt;second\_last\_migration&gt;** (in the example we’ve been following this would be **Update-Database –TargetMigration AddRating**).</span></span> <span data-ttu-id="4e197-250">Cette sauvegarde de la base de données à l’état de la deuxième des rôles dernière migration – efficacement « non application » la dernière migration à partir de la base de données.</span><span class="sxs-lookup"><span data-stu-id="4e197-250">This roles the database back to the state of the second last migration – effectively ‘un-applying’ the last migration from the database.</span></span>
    <span data-ttu-id="4e197-251">\*\*
    *Remarque : \*\*\* cette étape est nécessaire pour sécuriser de modifier les métadonnées de la migration dans la mesure où les métadonnées sont également stockées dans le \_ \_MigrationsHistoryTable de la base de données. C’est pourquoi vous devez uniquement utiliser cette option si la dernière migration est uniquement dans votre base de code local. Si d’autres bases de données était la dernière migration appliquée vous devrez également les annuler et ré-appliquer la dernière migration pour mettre à jour les métadonnées.*</span><span class="sxs-lookup"><span data-stu-id="4e197-251">**
*Note:****This step is required to make it safe to edit the metadata of the migration since the metadata is also stored in the \_\_MigrationsHistoryTable of the database. This is why you should only use this option if the last migration is only in your local code base. If other databases had the last migration applied you would also have to roll them back and re-apply the last migration to update the metadata.*</span></span> 
5.  <span data-ttu-id="4e197-252">Exécutez **Add-Migration &lt;complète\_nom\_notamment\_timestamp\_de\_dernière\_migration** &gt; (dans l’exemple Nous avons été suivant ce serait quelque chose comme **Add-Migration 201311062215252\_AddReaders**).</span><span class="sxs-lookup"><span data-stu-id="4e197-252">Run **Add-Migration &lt;full\_name\_including\_timestamp\_of\_last\_migration**&gt; (in the example we’ve been following this would be something like **Add-Migration 201311062215252\_AddReaders**).</span></span>
    <span data-ttu-id="4e197-253">\*\*
    *Remarque : \*\*\* vous devez inclure l’horodatage afin que les migrations sait que vous souhaitez modifier la migration existante au lieu d’une génération de modèles automatique.*</span><span class="sxs-lookup"><span data-stu-id="4e197-253">**
    *Note:****You need to include the timestamp so that migrations knows you want to edit the existing migration rather than scaffolding a new one.*</span></span>
<span data-ttu-id="4e197-254">Cela met à jour les métadonnées pour la dernière migration correspondre au modèle actuel.</span><span class="sxs-lookup"><span data-stu-id="4e197-254">This will update the metadata for the last migration to match the current model.</span></span> <span data-ttu-id="4e197-255">Vous obtiendrez l’avertissement suivant lors de la commande terminée, mais c’est exactement ce que vous voulez.</span><span class="sxs-lookup"><span data-stu-id="4e197-255">You’ll get the following warning when the command completes, but that’s exactly what you want.</span></span> <span data-ttu-id="4e197-256">«*Uniquement le Code de concepteur pour la migration « 201311062215252\_AddReaders' a été ré-généré automatiquement. Pour ré-structurer la migration entière, utilisez le paramètre - Force. »*</span><span class="sxs-lookup"><span data-stu-id="4e197-256">“*Only the Designer Code for migration '201311062215252\_AddReaders' was re-scaffolded. To re-scaffold the entire migration, use the -Force parameter.”*</span></span>
6.  <span data-ttu-id="4e197-257">Exécutez **Update-Database** demander à nouveau la dernière migration avec les métadonnées de mises à jour.</span><span class="sxs-lookup"><span data-stu-id="4e197-257">Run **Update-Database** to re-apply the latest migration with the updated metadata.</span></span>
7.  <span data-ttu-id="4e197-258">Continuer à développer ou les envoyer au contrôle de code source (après que exécution votre de tests unitaires bien entendu).</span><span class="sxs-lookup"><span data-stu-id="4e197-258">Continue developing, or submit to source control (after running your unit tests of course).</span></span>

<span data-ttu-id="4e197-259">Voici l’état de développeur \#local de 2 code base après l’utilisation de cette approche.</span><span class="sxs-lookup"><span data-stu-id="4e197-259">Here is the state of Developer \#2’s local code base after using this approach.</span></span>

![UpdatedMetadata](~/ef6/media/updatedmetadata.png)

## <a name="summary"></a><span data-ttu-id="4e197-261">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="4e197-261">Summary</span></span>

<span data-ttu-id="4e197-262">Il existe quelques problèmes lors de l’utilisation de Code First Migrations dans un environnement d’équipe.</span><span class="sxs-lookup"><span data-stu-id="4e197-262">There are some challenges when using Code First Migrations in a team environment.</span></span> <span data-ttu-id="4e197-263">Toutefois, une compréhension élémentaire du fonctionnement de la migration et de certaines approches simples pour la résolution des conflits de fusion facilitent surmonter ces défis.</span><span class="sxs-lookup"><span data-stu-id="4e197-263">However, a basic understanding of how migrations works and some simple approaches for resolving merge conflicts make it easy to overcome these challenges.</span></span>

<span data-ttu-id="4e197-264">Le problème fondamental est incorrecte métadonnées stockées dans la dernière migration.</span><span class="sxs-lookup"><span data-stu-id="4e197-264">The fundamental issue is incorrect metadata stored in the latest migration.</span></span> <span data-ttu-id="4e197-265">Par conséquent, Code First détecte de façon incorrecte que le modèle actuel et le schéma de base de données ne correspondent pas et structurer le code incorrect dans la prochaine migration.</span><span class="sxs-lookup"><span data-stu-id="4e197-265">This causes Code First to incorrectly detect that the current model and database schema don’t match and to scaffold incorrect code in the next migration.</span></span> <span data-ttu-id="4e197-266">Cette situation peut être surmontée en générant une migration vide avec le modèle correct, ou la mise à jour les métadonnées de la dernière migration.</span><span class="sxs-lookup"><span data-stu-id="4e197-266">This situation can be overcome by generating a blank migration with the correct model, or updating the metadata in the latest migration.</span></span>
